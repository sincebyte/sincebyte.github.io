[{"authors":[],"categories":[],"content":"åœ¨Neo Emacsä¸­åˆ¶ä½œè¡¨æ ¼å’Œç»˜å›¾å¯æå¤§æ¿€å‘æˆ‘ä»¬çš„ç”Ÿäº§åŠ›, é™¤äº†ä½¿ç”¨PlantUMLã€D2ã€dot graphvizç­‰ç»˜å›¾å·¥å…·å¤–, å¯ä»¥å°† org table ä¸ gnuplot ç»“åˆå½¢æˆå¼ºå¤§çš„ç»˜åˆ¶ç»Ÿè®¡æŠ¥è¡¨çš„éœ€æ±‚, è¿›è¡Œå„ç±»æ±‡æ€»æŠ¥å‘Šåˆ†æ.\nOrg Table org table æ”¯æŒè¿›è¡Œåˆ—è¿ç®—é€šè¿‡ #+TBLFM æ ‡ç­¾ç¼–å†™è¡¨è¾¾å¼å¯å¯¹åˆ—è¿›è¡Œå¤šæ¬¡çš„æ“ä½œ.\nTable 1: ç¬¦å·åŠæ„ä¹‰ ç¬¦å· æ„ä¹‰ å¼€å§‹å€¼ @ æŒ‡å®šè¡Œ 1 .. @3.. è¡¨ç¤ºä»ç¬¬3è¡Œä¹‹å \u0026#xa0; $ æŒ‡å®šåˆ— 1 :: åˆ†éš”ç¬¦å¤šä¸ªæ‰§è¡Œçš„è¡¨è¾¾å¼ \u0026#xa0; @# è¡Œå· 1 åˆ†æä¸‹é¢è¿™è¡Œè¡¨è¾¾å¼çš„æ„ä¹‰, ç­‰å·å·¦è¾¹è¡¨ç¤ºè¦èµ‹å€¼çš„è¡¨æ ¼çš„èŒƒå›´, @3..$1 è¡¨ç¤ºèµ‹å€¼èŒƒå›´ä»ç¬¬3è¡Œç¬¬1åˆ—è‡³æœ€åä¸€è¡Œç¬¬1åˆ—.\nç­‰å·å³è¾¹æ˜¯ä¸€ä¸ªè¿ç®—è¡¨è¾¾å¼, @2$1 è¡¨ç¤ºåˆå§‹å€¼ä¸ºç¬¬2è¡Œç¬¬1åˆ— . @# è¡¨ç¤ºå½“å‰è¡Œå·.\nç”±äºæˆ‘ä»¬æ˜¯ä»ç¬¬3è¡Œå¼€å§‹èµ‹å€¼, å› æ­¤è¡¨è¾¾å¼é¦–æ¬¡æ‰§è¡Œè¯¥å€¼ä¸º3, æœ€åè¿›è¡Œäº†å‡ 2, åˆ™ @3$1=2019+3-2.\né€šè¿‡åˆ†æå¯çŸ¥é“,è¿™ä¸ªè¡¨è¾¾å¼å…¶å®æ˜¯è®©ç¬¬ä¸€åˆ—ä»ç¬¬2è¡Œå¼€å§‹å‘åè‡ªå¢.\nå¹´åº¦ å¹³å°A å¹³å°B 2019 37 33 2020 75 25 2021 155 255 2022 268 398 2023 427 520 2024 640 740 2025 922 1022 2026 1271 1369 #+TBLFM: @3..$1=@2$1+@#-2 Gnuplot Histograms Gnuplot comes with a large collection of demonstration plots. You can step through these interactively by typing the command below in gnuplotâ€™s demo/ directory â€” it should be part of your installation, otherwise get it from the source code archive or file-by-file from the git repository.\nTable 2: gnuplot å‚æ•° command è¯´æ˜ å€¼åŸŸ data é€‰æ‹©æ•°æ®è¡¨æ ¼ è¡¨æ ¼è®¾ç½®: #+TBLNAME: data-bb3 exports å¯¼å‡ºæ–¹å¼ codeã€resultsã€bothã€none set title è®¾ç½®æ ‡é¢˜ æ˜¾ç¤ºåœ¨å›¾ç‰‡è¡¨æ ¼ä¸Šæ–¹ set boxwidth è®¾ç½®æŸ±å®½ å»ºè®®: 0-1ä¹‹é—´çš„å°æ•° set yrange è®¾ç½®Yè½´èŒƒå›´, æ”¹boxwidthç”Ÿæ•ˆ [0:1600] data u æ¯ä¸€è¡Œè®¾ç½®è¡¨ç¤ºä¸€ä¸ªç›´æ–¹å›¾ - plot 2:xticlabel(1) è®¾ç½®Y:Xè½´å¯¹åº”åˆ— 2è¡¨ç¤ºYè½´é«˜åº¦åˆ—, 1è¡¨ç¤ºç”¨ç¬¬1åˆ—ä½œä¸ºXè½´æ˜¾ç¤ºå†…å®¹ plot title è®¾ç½®å›¾ä¾‹å \u0026ldquo;legend\u0026rdquo; with boxes using 0:2:2 è®¾ç½®æŸ±æ ‡è®°æ•° 0:2:2, æœ€åä¸€ä¸ª2è¡¨ç¤ºç”¨å“ªåˆ—æ•°æ® using offset è®¾ç½®æŸ±æ ‡è®°æ•°ä½ç½® 0,0.5 åˆ†åˆ«è¡¨ç¤ºxå’Œyæ–¹å‘çš„åç§»é‡ with å›¾è¡¨ç±»å‹ histogramsã€pointsã€linepoints style å›¾è¡¨æ ·å¼ linecolorã€pointtypeã€pointsize set title \u0026quot;2019-2026 Computing power prediction\u0026quot; set grid set autoscale set boxwidth 0.9 set yrange [0:1800] set style histogram gap 1 set style fill solid 1.0 border plot data u 2:xticlabel(1) title \u0026quot;å¹³å°A\u0026quot; with histograms linecolor rgb \u0026quot;#3498DB\u0026quot;, \\ '' using 0:2:2 with labels center offset -1.5,0.5 notitle ,\\ data u 3:xticlabel(1) title \u0026quot;å¹³å°B\u0026quot; with histograms linecolor rgb \u0026quot;#1ABC9C\u0026quot;, \\ '' using 0:3:3 with labels center offset 1,0.5 notitle ,\\ data u 2:xticlabel(1) title \u0026quot;å¹³å°A\u0026quot; with linespoints pointtype 7 pointsize 0.6 linecolor 1, \\ data u 3:xticlabel(1) title \u0026quot;å¹³å°B\u0026quot; with linespoints pointtype 7 pointsize 0.6 linecolor 2 set title \u0026quot;2019-2026 computing power prediction line\u0026quot; set grid set autoscale set boxwidth 0.9 set yrange [0:1600] set style fill solid 1.0 border plot data u 2:xticlabel(1) title \u0026quot;å¹³å°A\u0026quot; with line, \\ '' using 0:2:2 with labels center offset -1,0.5 notitle ,\\ data u 3:xticlabel(1) title \u0026quot;å¹³å°B\u0026quot; with line, \\ '' using 0:3:3 with labels center offset 1,0.5 notitle ","permalink":"/posts/%E5%9C%A8neo-emacs%E4%B8%AD%E5%88%B6%E4%BD%9C%E8%A1%A8%E6%A0%BC%E5%92%8C%E7%BB%98%E5%9B%BE/","series":[],"tags":["org","emacs","gnuplot"],"title":"åœ¨neo Emacsä¸­åˆ¶ä½œè¡¨æ ¼å’Œç»˜å›¾"},{"authors":[],"categories":[],"content":"clickhouse å¯ç”¨äºè”æœºåˆ†æOLAPçš„åˆ—å¼æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ. å®šä½ä¸OLAPç¦»çº¿æ•°æ®å¤„ç†,ç›¸æ¯”äºOLTPåœ¨çº¿äº‹åŠ¡å¤„ç†,clickhouseæ›´å…³æ³¨äºæµ·é‡æ•°æ®çš„è®¡ç®—åˆ†æ, å…³æ³¨çš„æ˜¯æ•°æ®çš„ååã€æŸ¥è¯¢é€Ÿåº¦ã€è®¡ç®—æ€§èƒ½ç­‰æŒ‡æ ‡.\nç®€ä»‹ è€Œå¯¹äºæ•°æ®é¢‘ç¹çš„å˜æ›´ä¸æ“…é•¿. æ‰€ä»¥clickhouseé€šå¸¸ç”¨æ¥æ„å»ºåç«¯çš„æ—¶å®æ•°ä»“.\næ‰€è°“åˆ—å¼å­˜å‚¨æ˜¯æŒ‡,ä¸Mysqlè¿™ç§è¡Œå¼å­˜å‚¨çš„ä¸åŒ,æ•°æ®æ˜¯æŒ‰åˆ—æ¥é›†ä¸­å­˜å‚¨çš„.å› æ­¤åœ¨æˆ‘ä»¬è¿›è¡Œæœ‰é™çš„å­—æ®µæ•°æ®åˆ†æçš„æ—¶å€™ä¼šè¯»æ›´å°‘çš„æ–‡ä»¶,å› æ­¤å‡å°‘äº†å¾ˆå¤šçš„IOè¯»å–å·¥ä½œé‡.\nå¯¹clickhouseæœ€è€—çš„æ˜¯CPU, å› æ­¤clickhouseçš„éƒ¨ç½²éœ€è¦ç‹¬ç«‹çš„éƒ¨ç½² .\nOLAP\nOLAP scenarios require real-time responses on top of large datasets for complex analytical queries with the following characteristics:\nDatasets can be massive - billions or trillions of rows Data is organized in tables that contain many columns Only a few columns are selected to answer any particular query Results must be returned in milliseconds or seconds å®‰è£… sudo apt-get install -y clickhouse-server clickhouse-client sudo service clickhouse-server start clickhouse-client # or \u0026quot;clickhouse-client --password\u0026quot; if you've set up a password. show databases; # a attempt for clickhouse show tables; # a attempt for clickhouse è¡¨å¼•æ“ è¡¨å¼•æ“æ˜¯Clickhouseçš„ä¸€å¤§ç‰¹è‰²\nå»ºè¡¨æ—¶å¿…é¡»æŒ‡å®š, å†³å®šäº†å¦‚ä½•å­˜å‚¨è¡¨, ä»å“ªé‡Œè¯»å–æ•°æ®. æ”¯æŒå“ªäº›æŸ¥è¯¢,ä»¥åŠå¦‚ä½•æ”¯æŒ, æœ‰äº›è¯­æ³•åœ¨ç‰¹å®šçš„è¡¨å¼•æ“æ‰èƒ½ä½¿ç”¨. æ˜¯å¦å¯ä»¥å¤šçº¿ç¨‹è¯·æ±‚ æ•°æ®å¤åˆ¶å‚æ•° å¼•æ“ è¯´æ˜ TinyLog ä¸æ”¯æŒç´¢å¼•ã€æ²¡æœ‰å¹¶å‘. ä¸€èˆ¬ä¿å­˜å°é‡çš„æ•°æ® Memory æ•°æ®ä»¥æœªå‹ç¼©çš„åŸå§‹å½¢å¼ç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­, é‡å¯æ•°æ®ä¼šä¸¢å¤±, ç®€å•æŸ¥è¯¢ä¸‹æ€§èƒ½é«˜, ä¸å»ºè®®ç”Ÿäº§ä½¿ç”¨ MergeTree æ¯æ¬¡æ’å…¥æ—¶, å¼•æ“è¿›è¡Œä¸€æ¬¡åˆå¹¶å†å­˜å…¥æ•°æ®åº“, åˆå¹¶æ ‘å¼•æ“æ˜¯æœ€å¼ºå¤§çš„, è€Œä¸”å®ƒæœ‰å¾ˆå¤šå­åˆ†ç±» RepalingMergeTree æœ€å¤§ç¨‹åº¦ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ æ•°æ®åŒæ­¥ æœŸåˆæ•°æ®ä½¿ç”¨å…¨é‡åŒæ­¥çš„æ–¹å¼åŒæ­¥è‡³clickhouse å¢é‡æ•°æ®ä½¿ç”¨kettleæˆ–è€…logstashå®šæ—¶æŠ½å–è‡³clickhouse å®ç°\njdbc(datasource, schema, table) - returns table that is connected via JDBC driver.\nThis table function requires separate clickhouse-jdbc-bridge program to be running. It supports Nullable types (based on DDL of remote table that is queried).\nclickhouse sql statment\ninsert into report.target_table select * from jdbc('jdbc:mysql://localhost:3306/?user=root\u0026amp;password=root', `select * from origin_table where update_time\u0026gt;@1`) clickhouse execution\nclickhouse-client --user ${ck_user} --password ${ck_pass} --port ${ck_port} \\ -d report --multiquery \u0026lt; ../sql/${sql_name} ä»£ç é›†æˆ clickhouseæ”¯æŒJDBCé©±åŠ¨, å› æ­¤é›†æˆclickå°±å¦‚åŒé›†æˆä¸€ä¸ªæ•°æ®æºä¸€æ ·ç®€å•\nJDBCé©±åŠ¨\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.clickhouse\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;clickhouse-jdbc\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.4.6\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å¤šæ•°æ®æº\né…ç½®clickhouseå¤šæ•°æ®æºé…ç½®ç±»\npackage com.cloud.center.b3expand.config; import javax.sql.DataSource; import com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean; import com.zaxxer.hikari.HikariDataSource; import org.apache.ibatis.session.SqlSessionFactory; import org.mybatis.spring.annotation.MapperScan; import org.springframework.beans.factory.annotation.Qualifier; import org.springframework.boot.autoconfigure.jdbc.DataSourceProperties; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; /** * @author liu.zijie * @since 2023-09-12 **/ @Configuration @MapperScan(basePackages = \u0026quot;com.center.b3expand.mapper.clickhouse\u0026quot;, sqlSessionFactoryRef = \u0026quot;clickHouseSqlSessionFactory\u0026quot;) public class ClickHouseDataSourceConfig { @Bean(\u0026quot;ckDataSourceProperties\u0026quot;) @ConfigurationProperties(prefix = \u0026quot;spring.datasource.clickhouse\u0026quot;) public DataSourceProperties ckDataSourceProperties() { return new DataSourceProperties(); } @Bean(\u0026quot;ckDataSource\u0026quot;) @Qualifier(value = \u0026quot;ckDataSource\u0026quot;) @ConfigurationProperties(prefix = \u0026quot;spring.datasource.clickhouse.hikari\u0026quot;) public HikariDataSource ckDataSource() { return ckDataSourceProperties().initializeDataSourceBuilder().type(HikariDataSource.class).build(); } @Bean(name = \u0026quot;clickHouseSqlSessionFactory\u0026quot;) public SqlSessionFactory clickHouseSqlSessionFactory(@Qualifier(\u0026quot;ckDataSource\u0026quot;) DataSource dataSource) throws Exception { MybatisSqlSessionFactoryBean bean = new MybatisSqlSessionFactoryBean(); bean.setDataSource(dataSource); bean.setMapperLocations(new PathMatchingResourcePatternResolver() .getResources(\u0026quot;classpath:mapper/*.xml\u0026quot;)); bean.getObject().getConfiguration().setMapUnderscoreToCamelCase(true); bean.setTypeAliasesPackage(\u0026quot;com.center.b3expand.po\u0026quot;); return bean.getObject(); } } æ•°æ®åº“é…ç½®\nspring: datasource: clickhouse: driverClassName: com.clickhouse.jdbc.ClickHouseDriver enabled: true url: jdbc:clickhouse:http://localhost:8123 username: dev password: 123 hikari: minimum-idel: 20 maximum-pool-size: 20 b3: auto-configured: false url: username: password: hikari: minimum-idel: 20 maximum-pool-size: 20 å¹¶å‘æµ‹è¯• æ•°æ®åŸºå‡†: å¹¶å‘8ä¸ªæ¥è¿›è¡Œè®¡ç®—. æ¯ç§’å¹¶å‘8ä¸ªæ¯éš”0.5så†è§¦å‘ä¸€æ¬¡, åˆ™1åˆ†é’Ÿå†…æ‰§è¡ŒæŸ¥è¯¢ 60 * 2 * 8 = 960æ¬¡.\næµ‹è¯•æ–¹æ³•: åœ¨1åˆ†é’Ÿå†…, 3åˆ†é’Ÿå†…ã€5åˆ†é’Ÿå†…åˆ†åˆ«æ‰§è¡Œ960æ¬¡æŸ¥è¯¢æ¥è€ƒæ ¸é›†ç¾¤çš„æ€§èƒ½.\næŸ¥è¯¢SQL: 1600ä¸‡æ¡æ•°æ®, 15ä¸ªåˆ†ç»„å­—æ®µèšåˆæŸ¥è¯¢\n8æ ¸ä¸16æ ¸å‹æµ‹\næŒç»­æ—¶é—´ 8C ååé‡ æ¬¡/ç§’ 16C ååé‡ æ¬¡/ç§’ 8C å¹³å‡å“åº” ç§’ 16C å¹³å‡å“åº” ç§’ 8C CPUè´Ÿè½½ 16C CPUè´Ÿè½½ 8C å†…å­˜è´Ÿè½½ 16C å†…å­˜è´Ÿè½½ å‹æµ‹ 1 Minute 6.5 7.2 3.6 2.78 0.95 0.93 0.38 0.34 å‹æµ‹ 3 Minute 5.4 4.8 1.99 2.035 0.80 0.64 0.42 0.40 å‹æµ‹ 5 Minute 3.2 3.15 2.179 1.781 0.49 0.41 0.41 0.34 æ•°æ®æ˜¾ç¤º:\næ¨ªå‘å¯¹æ¯”:\nåœ¨1åˆ†é’Ÿå†…16æ ¸æœ€å¤šèƒ½æ”¯æŒæŸ¥è¯¢400å¤šæ¬¡ï¼ˆç°æœ‰ç¡¬ä»¶ä¸è¶³ä»¥æ”¯æ’‘ç»§ç»­å¢åŠ ç¡¬ä»¶ï¼‰, ä½†16æ ¸é›†ç¾¤è¡¨ç°å‡ºæ›´é«˜çš„ååé‡ï¼ˆ+11%ï¼‰åŠæ›´å¥½çš„å¹³å‡å“åº”æ—¶é—´ï¼ˆ+23%ï¼‰ åœ¨3åˆ†é’Ÿæ‰§è¡Œ960æ¬¡æŸ¥è¯¢çš„æƒ…å†µä¸‹, 4*16æ ¸çš„é›†ç¾¤è¡¨ç°å‡ºæ›´å¥½çš„ååé‡å’Œå¹³å‡å“åº”æ—¶é—´ï¼ˆä½†å·®è·ä¸å¤§ï¼‰, 16æ ¸çš„CPUæœ€é«˜è´Ÿè½½è¦æ›´ä½ï¼ˆ+25%ï¼‰,å†…å­˜è´Ÿè½½å‹åŠ›åŒºåˆ†ä¸å¤§. åœ¨5åˆ†é’Ÿæ‰§è¡Œ960æ¬¡æŸ¥è¯¢çš„æƒ…å†µä¸‹,ååé‡åŠå¹³å‡å“åº”æ—¶é—´å·®è·ä¸å¤§, CPUå’Œå†…å­˜çš„è´Ÿè½½æ›²çº¿æ¥è¿‘, è¯´æ˜å‹åŠ›éƒ½ä¸å¤§, ä¸”éƒ½èƒ½è¾ƒå¥½çš„å®ŒæˆæŸ¥è¯¢. çºµå‘å¯¹æ¯”:\n8æ ¸çš„ååé‡åœ¨5ã€3ã€1åˆ†é’Ÿçš„å‹æµ‹æƒ…å†µä¸‹, å¢å¹…ä¸º200% åŒæ ·16æ ¸çš„ååé‡çš„å¢å¹…ä¸º228%, å¯¹æ¯”å¢åŠ 28% 8æ ¸çš„å¹³å‡å“åº”æ—¶é—´åœ¨1ã€3ã€5åˆ†é’Ÿçš„å‹æµ‹æƒ…å†µä¸‹, å¢å¹…ä¸º165% åŒæ ·16æ ¸çš„å¹³å‡å“åº”çš„å¢å¹…ä¸º156%, å¯¹æ¯”é™ä½9% åœ¨è®¾å®šçš„æŸ¥è¯¢éœ€æ±‚æƒ…å†µä¸‹ï¼ˆ1600ä¸‡æ¡æ•°æ®, 15ä¸ªåˆ†ç»„å­—æ®µèšåˆæŸ¥è¯¢ï¼‰,å»ºè®®éƒ¨ç½²è§„æ ¼: 8æ ¸16G\nåœ¨1åˆ†é’Ÿæƒ…å†µä¸‹, 8æ ¸å’Œ16æ ¸éƒ½ä¸èƒ½æ»¡è¶³è¦æ±‚, ä¸”èƒ½æ”¯æ’‘çš„è¯·æ±‚æ•°é‡å‡ä¸º400å·¦å³, å·®å¼‚ä¸å¤§. åœ¨3åˆ†é’Ÿæƒ…å†µä¸‹, 8æ ¸CPUä½¿ç”¨ç‡80%, 16æ ¸CPUä½¿ç”¨ç‡ä¸º60%, æ‰€ä»¥8æ ¸CPUä¹Ÿè¶³ä»¥æ”¯æ’‘ä¸šåŠ¡è¦æ±‚. åœ¨5åˆ†é’Ÿæƒ…å†µä¸‹, 8æ ¸çš„CPUè´Ÿè½½ä¸º49%, 16æ ¸çš„CPUè´Ÿè½½ä¸º41%, ä½¿ç”¨éƒ½æœªè¶…è¿‡50%, éƒ½æœ‰è¶³å¤Ÿçš„å‰©ä½™. å¹¶å‘ä¼˜åŒ–\nå¤šåˆ†ç‰‡ã€å¤šå‰¯æœ¬, å¤šæ¬¡è¯·æ±‚å¯ä»¥å¯ä»¥å‡è¡¡çš„åˆ†æ‹…è‡³ä¸åŒçš„Node. ä»è€Œæå‡é›†ç¾¤çš„ååé‡ ç”±äºclickhouseå¯¹CPUæ¶ˆè€—å·¨å¤§,å› æ­¤é€šè¿‡é™æµæŠ€æœ¯æ§åˆ¶è®¿é—®æ¬¡æ•°ä¿è¯æœåŠ¡æŒç»­æœ‰æ•ˆä¹Ÿå°†æˆä¸ºä¸€é¡¹ä¼˜åŒ–é¡¹ åœ¨ä¸šåŠ¡åœºæ™¯æ»¡è¶³çš„æƒ…å†µä¸‹é€‚å½“ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ä¹Ÿæ˜¯è€ƒè™‘çš„ä¼˜åŒ–æ–¹æ¡ˆä¹‹ä¸€ å¯¹æ¯”ES Table 1: å„æ–¹é¢å¯¹æ¯”è¯´æ˜ å› ç´  è¯´æ˜ å»ºè®® æ€§èƒ½å±‚é¢ Clickhouseåœ¨å¤„ç†å¤æ‚èšåˆæƒ…å†µä¸‹, æ€§èƒ½è¡¨ç°æ›´å¥½ Clickhouse å¼€å‘å±‚é¢ Clickhouseåœ¨å®Œå…¨æ”¯æŒJDBCé©±åŠ¨ã€å­¦ä¹ æˆæœ¬ä½ã€å¿«é€Ÿä¸Šæ‰‹ Clickhouse æ•°æ®åº“å±‚é¢ Clickhouseåœ¨sqlå…¼å®¹æ€§æ–¹é¢æ¯”esè¦å¥½, æ˜“ç”¨æ€§ã€å¯ç»´æŠ¤æ€§æ›´ä½³ã€clickhouseå­¦ä¹ æˆæœ¬æ›´ä½ Clickhouse è¿ç»´å±‚é¢ Clickhouseå¯¹CPUå’Œå†…å­˜å¯¹ç¡¬ä»¶è¦æ±‚æ›´é«˜, ç¬æ—¶å¯¹èµ„æºæ¶ˆè€—æ›´å¤§ Elasticsearch ","permalink":"/posts/clickhouse-tutorial/","series":[],"tags":["java","clickhouse"],"title":"Clickhouse Tutorial"},{"authors":[],"categories":[],"content":"æœ€è¿‘å‡ å¹´elasticæ¨å‡ºäº†elastic lisence, elastic è®¤è¯ä»¥å¯¹ elastic çš„å®æ“æ€§è€ƒå¯Ÿéš¾åº¦è€Œé—»å. But, æˆ‘è®¤ä¸ºè¿™è¯æ˜äº†ä»–ä»¬å¯¹äººæ‰å¸‚åœºæŒ–æ˜çš„é›„å¿ƒ.\nIntroduction è®°å¾—å¤šå¹´ä»¥å‰çœ‹è¿‡ Elastic å®˜æ–¹çš„æ¦‚è¿°, å…¶ä¸­è®²åˆ°äº† Elastic å…¬å¸çš„å‘å±•. Elastic æ˜¯ä¸€å®¶å…¸å‹çš„ä»¥å¼€æºè½¯ä»¶ä¸ºæ¨¡å‹çš„ç›ˆåˆ©æ€§çš„å…¬å¸. Elastic æ—©å¹´åœ¨å‘å±•æœŸé—´è¿›è¡Œäº†å¾ˆå¤šå…è´¹çš„å…¬å¼€åŸ¹è®­, å®é™…ä¸ŠåŸ¹è®­çš„è¿‡ç¨‹é¦–å…ˆæ˜¯æ¨å¹¿äº† Elastic çš„çŸ¥ååº¦, å…¶æ¬¡ Elastic ä¸¾åŠæ–¹ä¹Ÿåœ¨è¿™æœŸé—´å‘æ˜ä¼˜ç§€çš„äººæ‰æ”¶ä¸ºå·±ç”¨, æ˜¯ä¸€ç§éå¸¸å“è¶Šçš„æ‹›è˜æ‰‹æ®µ. æœ€è¿‘å‡ å¹´ Elastic åˆæ¨å‡ºäº†Elastic Lisence, Elastic è®¤è¯ä»¥å¯¹ Elastic çš„å®æ“æ€§è€ƒå¯Ÿéš¾åº¦è€Œé—»å. æˆ‘è®¤ä¸ºè¿™è¯æ˜äº†ä»–ä»¬å¯¹äººæ‰å¸‚åœºæŒ–æ˜çš„é›„å¿ƒ.\nElasticæ˜¯ä¸€å®¶å¿«é€Ÿå‘å±•çš„å…¬å¸, å”¯ä¸€æƒ³åæ§½çš„ç‚¹æˆ‘è®¤ä¸ºå…¶æ–‡æ¡£è¿‡äºåºæ‚. å½“ç„¶äº›äº‹æƒ…ä¸æ¯«ä¸ä¼šå½±å“åˆ°Elasticåœ¨æœç´¢é¢†åŸŸä¸­çš„é¢†å…ˆçš„å¸‚åœºä»½é¢å’Œæ’å.\nInstall \u0026amp; config use package manager\nå®‰è£…æ­¥éª¤:\nä¸‹è½½debå®‰è£…åŒ…\næ‰§è¡Œå®‰è£…\nä¿®æ”¹é…ç½®, æœ€ç®€å•çš„è®¾ç½®æ‰€æœ‰ipå¯è®¿é—®, ä¸æ·»åŠ å®‰å…¨æƒé™\nè®¾ç½®æ“ä½œç³»ç»Ÿulimit\nå¯ç”¨elasticsearchæœåŠ¡\nå¯åŠ¨æœåŠ¡\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.9.1-amd64.deb sudo dpkg -i elasticsearch-8.8.2-amd64.deb sudo systemctl enable elasticsearch.service sudo vim /etc/elasticsearch/elasticsearch.yml # setting your config sudo su ulimit -n 65535 su elasticsearch sudo systemctl restart elasticsearch sudo journalctl \u0026ndash;unit elasticsearch\nuse uninsatll package\nhttps://www.elastic.co/downloads/past-releases/elasticsearch-8-8-2\nwget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.8.2-linux-x86_64.tar.gz tar -xvf elasticsearch-8.8.2-linux-x86_64.tar.gz Directory layout of Debian package\nhttps://www.elastic.co/guide/en/elasticsearch/reference/8.9/deb.html#deb-layout\nbin /usr/share/elasticsearch/bin\nUnInstall sudo dpkg -P elasticsearch # uninsatll sudo apt-get --purge autoremove elasticsearch sudo rm -rf /var/lib/elasticsearch/ sudo rm -rf /etc/elasticsearch Architecture Elastic search åœ¨å­˜æ”¾æ•°æ®çš„æ—¶å€™, éœ€è¦æœ‰å…ˆå°†æ•°æ®å­˜å‚¨è‡³ä¸»åˆ†ç‰‡, å†æ ¹æ®å¤åˆ¶è§„åˆ™å°†æ•°æ®å­˜å‚¨è‡³ä¸åŒçš„å­èŠ‚ç‚¹.\nè·¯ç”±åªæœ‰åˆ°äº†elasticsearchçš„åè°ƒèŠ‚ç‚¹ä»¥åæ‰çŸ¥é“å…·ä½“åº”è¯¥åˆ°å“ªä¸ªèŠ‚ç‚¹å†™æˆ–è€…å…·ä½“åº”è¯¥ä»å“ªäº›èŠ‚ç‚¹è¯». åœ¨å‘é€è¯·æ±‚æ—¶è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸æ˜ç¡®çš„.\nåè°ƒèŠ‚ç‚¹: ç”¨æˆ·å¯ä»¥è®¿é—®ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹æ¥è·å–elasticçš„é›†ç¾¤çš„æ•°æ® åˆ†ç‰‡æ•°é‡: å†™æ•°æ®çš„æ—¶å€™æœ‰è·¯ç”±è§„åˆ™å†³å®šå¦‚ä½•è·¯ç”±è‡³æŸä¸ªç‰¹å®šçš„åˆ†ç‰‡æ¥å†™å…¥ å‰¯æœ¬æ•°é‡: è¯»æ•°æ®çš„æ—¶å€™æ ¹æ®æ•°æ®å‰¯æœ¬å­˜æ”¾çš„èŠ‚ç‚¹æ¥è¿›è½®è¯¢è·¯ç”±è®¿é—® åˆ†è¯å™¨: IKåˆ†è¯å™¨, åˆ†è¯ç²—ç»†ç²’åº¦çš„è®¾ç½®, å¯è®¾ç½®æ‰©å±•è¯æ±‡ï¼ˆIKæä¾›çš„åŠŸèƒ½, ikplugin/config/custom.dicï¼‰ ä¸€è‡´æ€§: one, åªæœ‰å½“ä¸»èŠ‚ç‚¹å­˜å‚¨æˆåŠŸåˆ™å®¢æˆ·ç«¯å°±å¯ä»¥æŸ¥è¯¢ã€all, åªæœ‰æ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æˆåŠŸåŒæ­¥å¥½æ•°æ®ä»¥åå®¢æˆ·ç«¯æ‰èƒ½æŸ¥è¯¢è¿™ä¸ªæ•°æ® Restful Api Table 1: the difference between restful methodes post éå†¥ç­‰ put å†¥ç­‰ #åˆ›å»ºç´¢å¼•, å¹¶è®¾ç½®åˆ†ç‰‡æ•°é‡ , åˆ†ç‰‡æ•°é‡æ˜¯å½±å“æŸ¥è¯¢æ€§èƒ½çš„ä¸»è¦å› ç´ ä¹‹ä¸€ PUT http://cloudtencent.com:9200/shopping { \u0026quot;settings\u0026quot;: { \u0026quot;number_of_shards\u0026quot;: 15 } } #å°†ä¸€ä¸ªç´¢å¼•çš„æ•°æ®åŒæ­¥è‡³å¦å¤–ä¸€ä¸ªç´¢å¼•, è®¾ç½®ä¸€æ¬¡æ€§æŒ‰å¤šå°‘æ¡è®°å½•æ¥æäº¤ POST http://cloudtencent.com:9200/_reindex?slices=9\u0026amp;refresh\u0026amp;wait_for_completion=false { \u0026quot;source\u0026quot;: { \u0026quot;index\u0026quot;: \u0026quot;shopping\u0026quot;, \u0026quot;size\u0026quot;: 10000 }, \u0026quot;dest\u0026quot;: { \u0026quot;index\u0026quot;: \u0026quot;shopping_test_15\u0026quot; } } #è®¾ç½®docçš„å‰¯æœ¬ PUT http://cloudtencent.com:9200/shopping/_settings { \u0026quot;number_of_replicas\u0026quot;: 1 } #æŸ¥çœ‹ç´¢å¼• GET http://cloudtencent.com:9200/shopping #æŸ¥çœ‹æ‰€æœ‰ç´¢å¼• GET http://cloudtencent.com:9200/_cat/indices?v #åˆ é™¤ç´¢å¼• DELETE http://cloudtencent.com:9200/shopping #åˆ›å»ºæ•°æ® # POST http://cloudtencent.com:9200/shopping/_create POST http://cloudtencent.com:9200/shopping/_doc Content-Type: application/json { \u0026quot;title\u0026quot;:\u0026quot;å°ç±³æ‰‹æœº\u0026quot;, \u0026quot;category\u0026quot;:\u0026quot;å°ç±³\u0026quot;, \u0026quot;image\u0026quot;:\u0026quot;http://www.baidu.com\u0026quot;, \u0026quot;price\u0026quot;:39999.00 } #åˆ›å»ºæ•°æ®å¸¦id POST http://cloudtencent.com:9200/shopping/_doc/1002 Content-Type: application/json { \u0026quot;title\u0026quot;:\u0026quot;è£è€€æ‰‹æœº\u0026quot;, \u0026quot;category\u0026quot;:\u0026quot;åä¸º\u0026quot;, \u0026quot;image\u0026quot;:\u0026quot;http://www.baidu.com\u0026quot;, \u0026quot;price\u0026quot;:19999.00 } #æŸ¥è¯¢æ–‡æ¡£,æŒ‡å®šid GET http://cloudtencent.com:9200/shopping/_doc/1001 #æŸ¥è¯¢æ‰€æœ‰çš„æ•°æ® GET http://cloudtencent.com:9200/shopping/_search #ä¿®æ”¹æ•°æ® PUT http://cloudtencent.com:9200/shopping/_doc/1001 Content-Type: application/json { \u0026quot;title\u0026quot;:\u0026quot;å°ç±³æ‰‹æœºv3\u0026quot;, \u0026quot;category\u0026quot;:\u0026quot;å°ç±³\u0026quot;, \u0026quot;image\u0026quot;:\u0026quot;http://www.baidu.com\u0026quot;, \u0026quot;price\u0026quot;:29999.00 } # éƒ¨åˆ†æ›´æ–° POST http://cloudtencent.com:9200/shopping/_update/1001 Content-Type: application/json { \u0026quot;doc\u0026quot;: { \u0026quot;title\u0026quot;: \u0026quot;å°ç±³æ‰‹æœºv4\u0026quot; } } # åˆ é™¤æ•°æ® DELETE http://cloudtencent.com:9200/shopping/_doc/1001 # æ¡ä»¶æŸ¥è¯¢ GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;match\u0026quot;: { \u0026quot;category\u0026quot;: \u0026quot;å°ç±³\u0026quot; } } } # å…¨æŸ¥è¯¢ GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;match_all\u0026quot;: { } } } # åˆ†é¡µæŸ¥è¯¢ GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;match_all\u0026quot;: {} }, \u0026quot;from\u0026quot;: 0, \u0026quot;size\u0026quot;: 2 } # é€‰æ‹©åˆ—åŠæ’åº GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;match_all\u0026quot;: {} }, \u0026quot;from\u0026quot;: 0, \u0026quot;size\u0026quot;: 3, \u0026quot;_source\u0026quot;: [ \u0026quot;title\u0026quot; ], \u0026quot;sort\u0026quot;: { \u0026quot;price\u0026quot;: { \u0026quot;order\u0026quot;: \u0026quot;asc\u0026quot; } } } # å¤šæ¡ä»¶æŸ¥è¯¢åŠè¿‡æ»¤ GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;bool\u0026quot;: { \u0026quot;should\u0026quot;: [ { \u0026quot;match\u0026quot;: { \u0026quot;category\u0026quot;: \u0026quot;å°ç±³\u0026quot; } }, { \u0026quot;match\u0026quot;: { \u0026quot;category\u0026quot;: \u0026quot;åä¸º\u0026quot; } } ], \u0026quot;filter\u0026quot;: { \u0026quot;range\u0026quot;: { \u0026quot;price\u0026quot;: { \u0026quot;gt\u0026quot;:30000 } } } } } } # å…¨æ–‡æŸ¥è¯¢,å°åæ‹†æˆå°ã€åç„¶åå†åšå…¨æ–‡åŒ¹é… # é«˜äº®æ˜¾ç¤º GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;match_phrase\u0026quot;: { \u0026quot;category\u0026quot;: \u0026quot;åä¸º\u0026quot; } }, \u0026quot;highlight\u0026quot;: { \u0026quot;fields\u0026quot;: { \u0026quot;category\u0026quot;: {} } } } # èšåˆæ“ä½œ GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;aggs\u0026quot;: { \u0026quot;price_group\u0026quot;: { \u0026quot;terms\u0026quot;: { \u0026quot;field\u0026quot;: \u0026quot;price\u0026quot; } } }, \u0026quot;size\u0026quot; : 0 } # å¹³å‡æ“ä½œ # GET http://cloudtencent.com:9200/shopping/_search GET http://cloudtencent.com:9200/shopping/_search Content-Type: application/json { \u0026quot;aggs\u0026quot;: { \u0026quot;price_avg\u0026quot;: { \u0026quot;avg\u0026quot;: { \u0026quot;field\u0026quot;: \u0026quot;price\u0026quot; } } }, \u0026quot;size\u0026quot; : 0 } #åˆ›å»ºç´¢å¼• PUT http://cloudtencent.com:9200/user #elastic æ˜ å°„ PUT http://cloudtencent.com:9200/user/_mapping Content-Type: application/json { \u0026quot;properties\u0026quot;: { \u0026quot;name\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;text\u0026quot;, \u0026quot;index\u0026quot;: true }, \u0026quot;sex\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;keyword\u0026quot;, \u0026quot;index\u0026quot;: true }, \u0026quot;tel\u0026quot;: { \u0026quot;type\u0026quot;: \u0026quot;keyword\u0026quot;, \u0026quot;index\u0026quot;: false } } } # æŸ¥è¯¢æ˜ å°„ GET http://cloudtencent.com:9200/user/_mapping # å¢åŠ æ•°æ® POST http://cloudtencent.com:9200/user/_doc/1001 Content-Type: application/json { \u0026quot;name\u0026quot;:\u0026quot;å°ç±³\u0026quot;, \u0026quot;set\u0026quot;:\u0026quot;ç”·\u0026quot;, \u0026quot;tel\u0026quot;:\u0026quot;18729038467\u0026quot; } #æŸ¥è¯¢ GET http://cloudtencent.com:9200/user/_search Content-Type: application/json { \u0026quot;query\u0026quot;: { \u0026quot;match\u0026quot;: { \u0026quot;tel\u0026quot;: \u0026quot;18729038467\u0026quot; } } } Java SDK Dependency\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.elasticsearch.client\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;elasticsearch-rest-high-level-client\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;7.17.12\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--springbootçš„elasticsearchæœåŠ¡--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-elasticsearch\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;jakarta.json\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jakarta.json-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;jakarta.json\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jakarta.json-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.httpcomponents\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;httpclient\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.5.13\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; Configure\nHere we provide a bean named ElasticsearchClient.\npackage pkg.service; import org.apache.http.HttpHost; import org.apache.http.auth.AuthScope; import org.apache.http.auth.UsernamePasswordCredentials; import org.apache.http.client.CredentialsProvider; import org.apache.http.impl.client.BasicCredentialsProvider; import org.elasticsearch.client.RestClient; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import co.elastic.clients.elasticsearch.ElasticsearchClient; import co.elastic.clients.json.jackson.JacksonJsonpMapper; import co.elastic.clients.transport.ElasticsearchTransport; import co.elastic.clients.transport.rest_client.RestClientTransport; /** * @time 2023-09-04 15:02:32 **/ @Configuration public class ElasticSearchConf { @Bean public ElasticsearchClient restClient() { final CredentialsProvider credentialsProvider = new BasicCredentialsProvider(); credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(\u0026quot;elastic\u0026quot;, \u0026quot;*****\u0026quot;)); HttpHost nodeNodotOne = new HttpHost(\u0026quot;172.10.0.1\u0026quot;, 9200); HttpHost nodeNodotTwo = new HttpHost(\u0026quot;172.10.0.2\u0026quot;, 9200); HttpHost nodeNodotThree = new HttpHost(\u0026quot;172.10.0.3\u0026quot;, 9200); HttpHost[] elasticSearchNodes = new HttpHost[] { nodeNodotOne, nodeNodotTwo, nodeNodotThree }; // support multiple node RestClient httpClient = RestClient.builder(elasticSearchNodes) .setHttpClientConfigCallback(httpClientBuilder -\u0026gt; { httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider); return httpClientBuilder; }).build(); ElasticsearchTransport transport = new RestClientTransport( httpClient, new JacksonJsonpMapper()); ElasticsearchClient esClient = new ElasticsearchClient(transport); return esClient; } } Usage\npackage pkg.controller; import java.io.IOException; import javax.validation.Valid; import com.longda.fegion.dto.Result; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; import co.elastic.clients.elasticsearch.ElasticsearchClient; import co.elastic.clients.elasticsearch._types.ElasticsearchException; import co.elastic.clients.elasticsearch.core.GetResponse; import io.swagger.annotations.Api; import lombok.extern.slf4j.Slf4j; import pkg.po.Shopping; /** * @since 2023-09-04 16:04:58 **/ @Slf4j @Api(\u0026quot;ElasticSearchController\u0026quot;) @RestController @RequestMapping(\u0026quot;ElasticSearchController\u0026quot;) public class ElasticSearchController { @Autowired ElasticsearchClient restClient; /** * ElasticSearchController get */ @GetMapping(\u0026quot;/get\u0026quot;) public Result\u0026lt;Integer\u0026gt; get(@Valid String id) { try { GetResponse\u0026lt;Shopping\u0026gt; getResponse = restClient.get(getRequest -\u0026gt; getRequest.index(\u0026quot;shopping\u0026quot;).id(id), Shopping.class); Shopping source = getResponse.source(); log.info(\u0026quot;== document source: {}, response: {}\u0026quot;, source, getResponse); } catch (Exception e) { log.error(\u0026quot;==== [error]: {}\u0026quot;, e); } return Result.success(); } } Sqlquery\nTable 2: sqlè¯­æ³•æ”¯æŒæƒ…å†µ GRAMMER DESC SUPPORT select * wildcard âœ“ select money more_money rename âœ“ select * from (select \u0026#x2026;) subquery âœ“ count count âœ“ join index relation à¾¾ case when condition âœ“ in \u0026#xa0; âœ“ time \u0026gt; \u0026rsquo;2023-09-03T23:59:59\u0026rsquo; time range âœ“ group by a,b,c multiple group âœ“ maxã€minã€sumã€avg.. aggregation âœ“ /** * ElasticSearchController by sql */ @GetMapping(\u0026quot;/testsql\u0026quot;) public Result\u0026lt;Void\u0026gt; testSql() { String sql = \u0026quot;select count(*) from tmp_20230906\u0026quot;; try { QueryResponse queryResp = restClient.sql() .query(query -\u0026gt; query .format(\u0026quot;json\u0026quot;) .query(sql)); log.info(\u0026quot;==== [log]: {}\u0026quot;, queryResp.rows()); return Result.success(); } catch (Exception e) { log.error(\u0026quot;==== [error]: {}\u0026quot;, e); return Result.error(ResultEnum.COM_ERROR); } } Performance ç»è¿‡æµ‹è¯•, elasticsearchçš„æ€§èƒ½è¡¨ç°è‰¯å¥½; ä½†ä»ç„¶æ²¡è¾¾åˆ°ç§’çº§ä»¥å†…\nåŸå› : ä½¿ç”¨äº†15ä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„, è¿™åœ¨å®é™…ä¸šåŠ¡ä¸­å±äºæç«¯æƒ…å†µäº†, ä¸€ä¸ªæ­£å¸¸çš„æŸ¥è¯¢æ¯”å¦‚è®¢å•ã€å‡ºåº“å•, åœ¨æ•°æ®åº“è®¾è®¡è‰¯å¥½çš„æƒ…å†µä¸‹åº”è¯¥ä¸ä¼šå†—ä½™è¿™ä¹ˆå¤šçš„å­—æ®µ.\nTable 3: elasticsearché›†ç¾¤é…ç½®åŠsqlæƒ…å†µ å› ç´  å€¼ Elasticé›†ç¾¤æ•° 3 ä¸»æœºå†…å­˜ 32G ä¸»æœºCPU å¥”è…¾ï¼Ÿ æµ‹è¯•æ•°æ®é‡ 1600ä¸‡ æµ‹è¯•å­—æ®µ å…±60ä¸ª åˆ†ç»„å­—æ®µ group by å…±15ä¸ª èšåˆåˆ†æå­—æ®µ 40ä¸ª, å„ç§case when åŠ å‡å‰©é™¤ Table 4: æµ‹è¯•ç»“æœ Database Engin Initial Cost Cached Cost ES_TABLE ES1shard 20.5 0.1 tmp_20230905 ES3shard 9.5 0.1 tmp_test ES6shard 4.585401 0.1 tmp_20230907 ES9shard 3.468439 0.1 tmp_test_9 ES15shard 4.218455s 0.1 tmp_test_15 ","permalink":"/posts/elasticsearch-part1/","series":[],"tags":["java","elastic-search"],"title":"ElasticSearch Part1"},{"authors":[],"categories":[],"content":"Vimium C è§£å†³äº†åœ¨ Chrome ä¸­ä½¿ç”¨ Vimium éƒ¨åˆ†é¡µé¢ä¸ç”Ÿæ•ˆçš„é—®é¢˜, è®©å…¨é”®ç›˜æµå˜å¾—æ›´åŠ ä¸æ»‘.\nç¼˜èµ· ç”±äºå¸¸å¹´ä½¿ç”¨ Emacs, å¯¹äºä¸€åˆ‡å…¨é”®ç›˜çš„æ“ä½œéƒ½ç‰¹åˆ«å…´å¥‹, æµè§ˆå™¨æ˜¯æ—¥å¸¸å·¥ä½œå­¦ä¹ ä¸­å¿…ä¸å¯å°‘çš„å·¥å…·. æœ€æ—©æˆ‘ä½¿ç”¨Vimium. æœ€è¿‘å¼€å§‹ä½¿ç”¨Vimium C, Vimium C è§£å†³äº†åœ¨chromeä¸­ä½¿ç”¨Vimiumå¤šå¹´æ¥çš„å°éƒ¨åˆ†å›°æ‰°, è®©å…¨é”®ç›˜æµå˜å¾—æ›´åŠ ä¸æ»‘ğŸ‘.\nVimium Vimium æä¾›äº†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨é”®ç›˜æ“ä½œçš„æœ€é€šç”¨ã€å¸¸è§çš„åŠŸèƒ½. è¿™é‡Œåˆ—å‡ºä¸€äº›æˆ‘ç”¨åˆ°çš„æœ€å¤šçš„ç‰¹æ€§.\nTable 1: Vimium å¸¸è§æ“ä½œå¿«æ·é”®é€Ÿè§ˆ features shortkey next tab K previous tab J close Tab x new tab t jump to link f scroll up u scroll down d copy current url yy search char / next search n previous search N è®¾ç½®\nè®©æœ¬åœ°æ–‡ä»¶ä¹Ÿèƒ½ä½¿ç”¨vimiumçš„å¿«æ·é”®, éœ€è¦åœ¨æ’ä»¶ç®¡ç†å†…è®¾ç½®: Allow access to file URLs åœ¨vimiumçš„optionè®¾ç½®é¡µè®¾ç½®new tab: any website. è¿™æ ·åœ¨new tabæ‰“å¼€æ—¶å°±ä¹Ÿèƒ½ä½¿ç”¨vimiumçš„å¿«æ·é”®. å…¶ä»–çš„.. å¥½åƒæ²¡äº† é—®é¢˜\nvimium ä½¿ç”¨çš„è¶Šå¤š, å…¶ä¸­ä¸€ä¸ªé—®é¢˜å‡¸æ˜¾çš„è¶Šæ˜æ˜¾. é‚£å°±æ˜¯vimiumåœ¨ chrome çš„æŸäº›è‡ªå®šä¹‰é¡µé¢ä¸å¯ä½¿ç”¨, æ¯”å¦‚ chromeçš„æ’ä»¶è®¾ç½®é¡µ, æˆ–è€…chromeçš„é»˜è®¤new tabé¡µ, æ¯å½“ç¢°åˆ°è¿™äº›é¡µé¢çš„æ—¶å€™,è¦ä¹ˆæˆ‘ä»¬ä½¿ç”¨ `command + l` è·³è½¬è‡³ä¸€ä¸ªæ–°çš„ç½‘é¡µ, è¦ä¹ˆå°±åªèƒ½å»ç¢°é¼ æ ‡äº†. ç„¶è€Œåœ¨vimiumä¸­è¿™ä¸ªé—®é¢˜å‡ ä¹æ— è§£.\nVimium C Vimium C å·ç§°æ˜¯Vimium çš„åŠ å¼ºç‰ˆ. å…¶ä¸­å°±è§£å†³äº†Vimiumçš„éƒ¨åˆ†é¡µé¢å¤±æ•ˆçš„é—®é¢˜, è€Œä¸”å…¶æœç´¢æ¯”Vimiumè¦æ›´å¥½ç”¨.Vimium C çš„å¿«æ·é”®å’ŒVimiumåœ¨æˆ‘ä¸Šé¢æåˆ°çš„èŒƒå›´å†…æ˜¯ä¸€æ¨¡ä¸€æ ·çš„, è¿™å‡ ä¹æ˜¯å¯ä»¥æ— æ„Ÿå¹³æ›¿.å…¶æ¬¡åœ¨Vimium C å†…å¯ä»¥é…ç½®åœ¨chromeçš„æ‰€æœ‰é¡µé¢éƒ½æœ‰æ•ˆ, åŒ…æ‹¬chromeçš„settingé¡µ. å¤§å®¶è®¾ç½®å¥½å°±çºµæƒ…ä½“éªŒå§!\nè®¾ç½®\nåœ¨Vimium C å†…è®¾ç½®åœ¨chromeçš„æ’ä»¶é¡µç”Ÿæ•ˆ: option\u0026gt;Advanced Options\u0026gt; Run on chrome://*/* pages (need #extensions-on-chrome-urls) åœ¨Vimium C å†…è®¾ç½®åœ¨chromeçš„æ–°tabé¡µç”Ÿæ•ˆ: option\u0026gt;Run on Chromeâ€™s native New Tab Page (need #extensions-on-chrome-urls) è®¾ç½®ä¸Šé¢ä¸¤é¡¹çš„å‰æ, å…ˆè®¾ç½® chrome://flags/\u0026gt;Extensions on chrome:// URLs\u0026gt;enable, å¹¶é‡å¯å°±å¯ä»¥äº†. åœ¨Vimium C å†…ç¦ç”¨bæŒ‰é”®: option\u0026gt;Custom key mappings\u0026gt;unmap b, ä¿å­˜ç”Ÿæ•ˆ ","permalink":"/posts/vimiumc/","series":[],"tags":["emacs","Chrome"],"title":"VimiumC"},{"authors":[],"categories":[],"content":"åœ¨ä½¿ç”¨ doom emacs çš„æ—¶å€™ workspace æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°çš„åŠŸèƒ½.é‚£ä¹ˆå¦‚ä½•åœ¨è¿›è¡Œbufferåˆ‡æ¢æ—¶æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ç©ºé—´å‘¢ï¼Ÿæ¯”å¦‚å¿«é€Ÿæ‰¾vtermè¿™ä¸ªç©ºé—´, æˆ–è€…è¯´httpè¿™ä¸ªç©ºé—´å‘¢ï¼Ÿ\nç—›ç‚¹ åœ¨ä½¿ç”¨ doom emacs çš„æ—¶å€™ workspace æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°çš„åŠŸèƒ½. ä½†æ˜¯é»˜è®¤çš„workspaceåœ¨è®¾ç½®workspaceçš„åç§°çš„æ—¶å€™ä½¿ç”¨äº†ç¼–å·(#No.)è¿›è¡Œå‘½å,æ²¡æœ‰å®é™…çš„ä¸Šä¸‹æ–‡å«ä¹‰.\næˆ‘ç»å¸¸å¼€å¤šä¸ªworkspace, é¢‘ç¹çš„åœ¨å¤šä¸ªworkspaceä¸­åˆ‡æ¢. ä¸€èˆ¬åœ¨åšåç«¯javaå¼€å‘çš„æ—¶å€™,æˆ‘ä¹ æƒ¯è‡³å°‘è¦å¼€å››ä¸ªworkspace, å·¥ä½œä¸­å¾€å¾€éœ€è¦å†ç»™ç©ºé—´å¦å¤–å‘½å. ä½†æ¯æ¬¡å…³é—­åˆéœ€è¦é‡æ–°å‘½åæ“ä½œ, éå¸¸çš„éº»çƒ¦.\nlsp-java ä»£ç å·¥ç¨‹ç©ºé—´ ejcsql æ•°æ®åº“ç©ºé—´ rest-client ä½œä¸ºæµ‹è¯•æ¥å£çš„ç©ºé—´ org-mode æ–‡æ¡£ç©ºé—´ é‚£ä¹ˆå¦‚ä½•åœ¨è¿›è¡Œbufferåˆ‡æ¢æ—¶æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„ç©ºé—´å‘¢ï¼Ÿæ¯”å¦‚å¿«é€Ÿæ‰¾vtermè¿™ä¸ªç©ºé—´, æˆ–è€…è¯´httpè¿™ä¸ªç©ºé—´å‘¢ï¼Ÿ\nè§£å†³ å…¶å®æœ€ç»ˆæœŸæœ›çš„æ•ˆæœæ˜¯é‡Šæ”¾æ‰‹åŠ¨è®¾ç½®workspaceçš„åç§°è¿™ä¸ªåŠ¨ä½œ, å°è¯•ç”¨elispæ¥å¸®æˆ‘ä»¬å®ç°åˆ©ç”¨å½“å‰bufferçš„åç§°ä½œä¸ºworkspaceçš„åç§°.\nå¯ä»¥åˆ©ç”¨ pre-command-hook é’©å­åœ¨æ¯æ¬¡æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™å¯¹ workspace çš„åç§°è¿›è¡Œä¸€æ¬¡è®¾ç½®. ä¸ºäº†æå‡æ•ˆç‡, å½“åˆ¤å®šå‡ºbuffer-nameä¸workspace-nameç›¸åŒæ—¶, åˆ™ä¸éœ€è¦å†æ¬¡è®¾ç½®workspaceçš„åç§°. æ­¤å¤–åœ¨è¿›è¡Œrecentfã€fzfç­‰æ“ä½œçš„æ—¶å€™ workspace åç§°æ— éœ€è·Ÿéšæ”¹å˜. åˆ™æœ‰äº†ä¸‹é¢çš„ä»£ç .\néœ€è¦æ³¨æ„çš„æ˜¯workspaceè¦æ±‚åç§°å”¯ä¸€,å› æ­¤å¦‚æœæˆ‘ä»¬åœ¨2ä¸ªbufferä¸­æ‰“å¼€äº†åŒä¸€ä¸ªæ–‡ä»¶æ­¤æ—¶åˆå°†workspaceçš„åç§°è®¾ç½®æˆäº†bufferçš„åç§°åˆ™workspaceä¼šæç¤ºå¼‚å¸¸ï¼ˆåç§°æœªå‘ç”Ÿæ”¹å˜ï¼‰.\nåˆ°è¿™é‡ŒçŒ›ç„¶å‘ç°æƒ³è¦çš„ä¸å°±æ˜¯ tab æ ‡ç­¾æ çš„æ•ˆæœå—ï¼ŸAnyway å°±æ˜¯ä¹ æƒ¯äº†çœ‹ workspace ~ happy.\n(add-hook 'pre-command-hook (lambda () (if (or (eq (buffer-name) (+workspace-current-name)) (string-match \u0026quot;*Minibuf\u0026quot; (buffer-name)) ) nil (+workspace:rename (buffer-name))))) eslipä»£ç å­¦ä¹  éœ€è¦æ³¨æ„çš„æ˜¯, string-match è¿™ä¸ªå‡½æ•°å½“ä¸åŒ¹é…çš„æ—¶å€™å°±è¿”å›nil,åŒ¹é…çš„æ—¶å€™è¿”å›æ•°å­—. å…¶å®å®ƒçš„ç»“æœå¯ç›´æ¥è¢«ifè¯­å¥ç”¨äºåˆ¤æ–­æ¡ä»¶çš„.æ— éœ€å†è¿›è¡Œè½¬æ¢äº†.å¦å¤–pre-command-hookå’Œpost-command-hookè¿™ä¸¤ä¸ªhookéƒ½å¯ä»¥å®ç°æœ¬æ¬¡çš„åŠŸèƒ½, ä½†post-command-hookæ—¶è€Œä¼šå‡ºç°ä¸€äº›å¼‚å¸¸çš„æƒ…å†µ.è¿™ä¸ªä¸ä¸¤ä¸ªhookçš„æ‰§è¡Œæ—¶é—´æœ‰å…³ç³», pre-command-hook æ˜¯åœ¨commanæ‰§è¡Œä¹‹å‰å°±å…ˆæ‰§è¡Œhook, post-command-hookæ˜¯åœ¨commandæ‰§è¡Œä¹‹åæ‰æ‰§è¡Œçš„hook.å®è·µè¯æ˜hookåº”è¯¥è¦æ”¾åœ¨æ‰§è¡Œå‰è¿˜æ˜¯æ‰§è¡Œåå¹¶æ— å®é™…çš„å½±å“.\né“µé”®é…ç½® åŒæ—¶ä¹Ÿåˆ†äº«ä¸‹neo-emacsä¸­å¯¹äºworkspaceå¿«æ·é”®çš„è®¾ç½®. æœ€å¸¸ç”¨çš„å°±æ˜¯å·¦å³åˆ‡æ¢workspaceäº†, å› æ­¤è®¾ç½®äº†Kã€Jæ¥è¿›è¡Œåˆ‡æ¢.\nè¿˜æœ‰å¯¹workspaceè¿›è¡Œä½ç½®çš„ç§»åŠ¨,è¿™å…¶å®æ˜¯ä¸€ä¸ªä½é¢‘çš„åŠŸèƒ½.å› æ­¤è®¾ç½®åœ¨äº† command+k ã€ command+j æ¥åˆ†åˆ«å·¦ç§»å’Œå³ç§».\n(map! :n \u0026quot;K\u0026quot; '+workspace/switch-right ) (map! :n \u0026quot;J\u0026quot; '+workspace/switch-left ) (map! :n \u0026quot;s-k\u0026quot; '+workspace/swap-right ) (map! :n \u0026quot;s-j\u0026quot; '+workspace/swap-left ) å…¶ä»–é—®é¢˜ å¦‚æœbufferçš„åç§°è¿‡é•¿äº†ä¼šå ç”¨åº•éƒ¨å¤ªå¤šçš„ç©ºé—´. è¿™ä¸ªè¿˜æ¯”è¾ƒå¥½ä¼˜åŒ– æ¯æ¬¡ workspace-rename ä»¥å,è¯¥ workspace çš„æ’åºè¢«ç§»åŠ¨åˆ°äº†æœ€å³è¾¹. workspace ä½ç½®äº§ç”Ÿç§»åŠ¨ä¼šæ‰“ä¹±æˆ‘ä»¬å¯¹ç©ºé—´é¡ºåºçš„å›ºæœ‰æ€ç»´. æš‚æ—¶æ— è§£ç­” å¦‚æœåœ¨2ä¸ªä¸åŒçš„workspaceä¸­æ‰“å¼€ç›¸åŒçš„æ–‡ä»¶, ç¨‹åºä¼šè‡ªåŠ¨è®¾ç½®workspacenameä¸ºæ–‡ä»¶å, ä½†æ˜¯workspaceä¸å…è®¸è®¾ç½®ä¸ºç›¸åŒ,å› æ­¤ä¼šå‡ºç°bufferåˆ‡æ¢äº†ä½†æ˜¯workspacenameæ²¡æ›´æ”¹çš„æƒ…å†µ,ä¹Ÿç®—æ˜¯ä¸€ç§é”™ä¹±. ","permalink":"/posts/emacs-workspace/","series":[],"tags":["emacs","doom"],"title":"Emacs Workspace"},{"authors":[],"categories":[],"content":"Hugo can build a personal blog conveniently and quickly, providing comments, categories, searches, skins, subscriptions and other functions. Its open source code allows users to customize its default behavior at will.\nnew post Table 1: create a new post steps step process location illustrate 1 hugo new posts/post-name.md your site root path your post content 2 draft: false post-name.md header ready for public or not 3 toc: true post-name.md header title of content or not 4 summarize \\n \u0026lt;!\u0026#x2013;more\u0026#x2013;\u0026gt; post-name.md header after summarize of this post 5 revise your outline every outline with # make sure the outline is correct 6 delete markdown\u0026rsquo;s toc post-name.md header after use hugo\u0026rsquo;s toc exclusively --- title: \u0026quot;Sony A7c å…¥é—¨\u0026quot; date: 2023-08-21T08:46:42+08:00 draft: false toc: true --- Sony a7c ç›¸æœºå…¥é—¨åŸºç¡€çŸ¥è¯†æ•´ç† \u0026lt;!--more--\u0026gt; \u0026lt;a id=\u0026quot;orgd017a38\u0026quot;\u0026gt;\u0026lt;/a\u0026gt; ## devlog è®¾ç½® ... quote images The image need located at %yoursite%/public/posts/postname/ .\nUsually I put the image into a sub directory image , thus it looks like %yoursite%/public/posts/postname/image/pattern.png .\ncss customize Create your customize css file at %yoursite%/static/css/default.css .\nput default css into the %yoursite%/themes/hugo-eureka/layouts/_default/baseof.html.\n\u0026lt;link rel=\u0026quot;stylesheet\u0026quot; href=\u0026quot;/css/default.css\u0026quot;\u0026gt; tbody, th, tbody td { border: 1px solid #666; } tbody tr:nth-child(odd) { background-color: var(--color-primary-bg) } ","permalink":"/posts/hugo-usage/","series":[],"tags":["hugo","org"],"title":"Hugo Usage"},{"authors":[],"categories":[],"content":"Sony a7c ç›¸æœºå…¥é—¨åŸºç¡€çŸ¥è¯†æ•´ç†\ndevlog è®¾ç½® è®¾ç½®ï¼špp9 ï¼Œä¼½ç›ï¼šHLG3\nISO: 800-1000\nç™½å¹³è¡¡æ¨¡å¼ï¼šè§å…‰ç¯ï¼šå†·ç™½è‰²\nå¯¹ç„¦æ¨¡å¼ï¼šAF-C\nå¯¹ç„¦åŒºåŸŸï¼šå¹¿åŸŸ\næ›å…‰è¡¥å¿ï¼š0\næµ‹å…‰æ¨¡å¼ï¼šæ•´ä¸ªå±å¹•å¹³å‡/ç‚¹æµ‹å…‰æ ‡å‡†\nç›¸æœºæ‹æ‘„æ¨¡å¼ æ¨¡å¼ è¯´æ˜ AUTO è‡ªåŠ¨æ¨¡å¼ P ISOå…ˆå†³æ¨¡å¼ A å…‰åœˆå…ˆå†³æ¨¡å¼ S å¿«é—¨å…ˆå†³æ¨¡å¼ M å…¨æ‰‹åŠ¨æ¨¡å¼ ISO æ•°å€¼ æ•ˆæœ 100 æˆ·å¤–æ™´å¤© 400 æˆ·å¤–é˜´å¤© 800 è‰¯å¥½ 1600 å®¤å†… 3200 æ™šä¸Šè¡—æ‹ æ›´é«˜ ä¸å»ºè®® å¿«é—¨ å¿«é—¨é€Ÿåº¦ é€‚åˆåœºæ™¯ 1/25 é™ç‰© 1/50 äººåƒ 1/250 æ‰«è¡— 1/1000 ä½“è‚² 1/2 è½¦æµ 10s æ˜Ÿç©º 15s æµæ°´ 30s çƒŸèŠ± Få…‰åœˆ Få€¼è¶Šå¤§ã€å…‰åœˆè¶Šå°\næ§åˆ¶è¿›å…‰é‡å’Œæ™¯æ·±\nFå€¼è¶Šå¤§, æ™¯æ·±è¶Šå¤§, æ¨¡ç³Šè¶Šä¸æ˜æ˜¾\nFå€¼ åœºæ™¯ 1.4 äººåƒ 2.8-4 è¡—æ‹ 8-16 é£æ™¯ è®©å›¾æ›´äº® æŒ‰ä¼˜å…ˆé¡ºåºè¿›è¡Œè°ƒæ•´\n1ã€é™ä½å¿«é—¨é€Ÿåº¦\n2ã€å¼€å¤§å…‰åœˆ\n3ã€è°ƒé«˜ISO\nè®©å›¾æ›´æš— æŒ‰ä¼˜å…ˆé¡ºåºè¿›è¡Œè°ƒæ•´\n1ã€é™ä½ISO\n2ã€å¢åŠ å¿«é—¨é€Ÿåº¦\n3ã€å‡å°å…‰åœˆ\nè¯´æ˜å›¾ ","permalink":"/posts/sony-a7c-%E5%85%A5%E9%97%A8/","series":[],"tags":["a7c"],"title":"Sony A7c å…¥é—¨"},{"authors":[],"categories":[],"content":"mac stage manager æä¾›äº†ä¸€ä¸ªçœŸæ­£æ— æ‰“æ‰°çš„å·¥ä½œç¯å¢ƒ.\næœ€è¿‘ä½¿ç”¨ macos çš„ stage manager, æ„Ÿè§‰ååˆ†æ¸…çˆ½. stage manager æä¾›äº†ä¸€ä¸ªçœŸæ­£æ— æ‰“æ‰°çš„ç¯å¢ƒ, åœ¨æ­¤æ¨¡å¼ä¸‹å¯ä»¥å±è”½å…¶ä»–çš„çª—å£, åªæ˜¾ç¤ºå½“å‰çª—å£. ç”šè‡³å¯ä»¥å±è”½æ¡Œé¢çš„æ–‡ä»¶, å› æ­¤å¥½çœ‹çš„å£çº¸å¯ä»¥ â€œæ— æ±¡æŸ“â€ çš„å±•ç¤ºäº†. ä¸è¿‡éå¸¸å¯æƒœçš„æ˜¯, stage manager æœªæä¾›åˆ‡æ¢ä¸åŒ application çš„å¿«æ·é”®è®¾ç½®. å€˜è‹¥ä½¿ç”¨ Alfred ç­‰è½¯ä»¶åˆæ— æ³•ä¸€é”®åˆ‡æ¢åº”ç”¨, å¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ mac æä¾›çš„ Automator æ¥å®ç°ä¸€é”®åˆ‡æ¢åº”ç”¨.\ncontent å°è¯•ä¸€ é¦–å…ˆ, æ‰“å¼€ Automator.app \u0026gt; File new (command N) \u0026gt; Quick Action \u0026gt; Run AppleScript\nè¾“å…¥å¦‚ä¸‹ä»£ç , å¹¶ä½¿ç”¨æ’­æ”¾æŒ‰é”®, è¿›è¡Œç®€å•æµ‹è¯•. å¦‚æœèƒ½æˆåŠŸåˆ‡æ¢è‡³ Emacs è¯´æ˜ç¨‹åºç”Ÿæ•ˆäº†.\næ¥ä¸‹æ¥å°†æ­¤ Automator ç¨‹åºä¿å­˜å¹¶å‘½å OpenEmacs\n1 on run {input, parameters} 2 3 (* Your script goes here *) 4 tell application \u0026quot;Emacs\u0026quot; 5 activate 6 end tell 7 8 end run å…¶æ¬¡,æˆ‘ä»¬ä¸º OpenEamcs è®¾ç½®ä¸€ä¸ªå¿«æ·é”®. æ‰“å¼€ System Settings.app \u0026gt; Keyboard \u0026gt; Keyboard Shortcuts \u0026gt; Service \u0026gt; General\né€‰æ‹© OpenEmacs å¹¶è®¾ç½®å¿«æ·é”®. ä¿å­˜åä½¿ç”¨å¿«æ·é”®è¿›è¡Œæµ‹è¯•.\næˆ‘è‡ªå·±å°† command + R è®¾ç½®ä¸º Chrome çš„å¿«æ·é”®. å°† command + K è®¾ç½®ä¸º Emacs çš„å¿«æ·é”®.\næ³¨æ„ Keyboard çš„å¿«æ·é”®å¯èƒ½å’Œç³»ç»Ÿçš„å¿«æ·é”®ä»¥åŠå’Œappå†…ç½®çš„å¿«æ·é”®å†²çª,\nç»æµ‹è¯•å‘ç° Keyboard çš„å¿«æ·é”®æœ‰å…ˆçº§æ¯”è¾ƒä½, å¦‚è¿‡å†²çªåˆ™æŒ‰é”®äº‹ä»¶æ— æ³•æŠµè¾¾ Automator.\nå› æ­¤éœ€è¦æ ¹æ®å¤§å®¶çš„åº”ç”¨æƒ…å†µè®¾ç½®åˆç†çš„å¿«æ·é”®\nå°è¯•äºŒ å…¶çµæ„Ÿæ¥æºäºæŸä¸ªAPP, å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»„åˆé”®æ¥å¯¹æŸä¸ªåº”ç”¨è¿›è¡Œ Toggle Visual. Toggle è¿™ä¸ªå•è¯å¤§å®¶åº”è¯¥ä¸é™Œç”Ÿ, å°±æ˜¯åˆ‡æ¢çš„æ„æ€.\nä½¿ç”¨åŒä¸€ä¸ªæŒ‰é”®å½“åº”ç”¨æ­¤æ—¶æ­£æ‰“å¼€çš„æ—¶åˆ™å°†å…¶éšè—, å½“æ­¤æ—¶åº”ç”¨æ­£éšè—æ—¶å°†å…¶æ”¾åœ¨æ¡Œé¢æœ€ä¸Šå±‚.\nåœ¨æˆ‘çš„ laptop ä¸Š, æˆ‘å°† Emacs ç»‘å®šè‡³ command + k å’Œ Chrome ç»‘å®šè‡³ command + h, é”®ä½å†²çªè¾ƒå°‘å¯ä¾›å¤§å®¶å‚è€ƒ.\n1 tell application \u0026quot;System Events\u0026quot; 2 if visible of application process \u0026quot;Emacs\u0026quot; is true then 3 set visible of application process \u0026quot;Emacs\u0026quot; to false 4 else 5 tell application \u0026quot;Emacs\u0026quot; to activate 6 end if 7 end tell å°è¯•ä¸‰ å°è¯•äºŒçš„ä¼˜åŒ–, å°è¯•äºŒä½¿ç”¨äº† applescript å¸¦æ¥çš„é—®é¢˜æ˜¯, åˆ‡æ¢åº”ç”¨çš„é€Ÿåº¦æ˜æ˜¾èƒ½æ„Ÿè§‰åˆ°æœ‰å»¶è¿Ÿ.ç½‘ä¸Šæœç´¢åˆ°äº†ä½¿ç”¨ hammerspoon çš„æ–¹æ¡ˆ, äº²è‡ªæµ‹è¯•äº†ä¸‹é€Ÿåº¦éå¸¸å¿«, å¯ä»¥è¯´æ˜¯ç»ˆçº§è§£å†³æ–¹æ¡ˆäº†.\ntoggleApp = function(appName, launch) launch = launch or false local app = hs.application.get(appName) if app then if app:isFrontmost() then app:hide() else app:activate() end else if launch then hs.application.launchOrFocus(appName) else hs.alert.show(\u0026quot;App '\u0026quot; .. appName .. \u0026quot;' is not loaded!\u0026quot;) end end end hs.hotkey.bind({\u0026quot;cmd\u0026quot;}, \u0026quot;K\u0026quot;, function() toggleApp(\u0026quot;Emacs\u0026quot;) end) hs.hotkey.bind({\u0026quot;cmd\u0026quot;}, \u0026quot;F\u0026quot;, function() toggleApp(\u0026quot;Finder\u0026quot;) end) hs.hotkey.bind({\u0026quot;cmd\u0026quot;}, \u0026quot;R\u0026quot;, function() toggleApp(\u0026quot;Google Chrome\u0026quot;) end) ","permalink":"/posts/stage%E5%BF%AB%E6%8D%B7%E9%94%AE/","series":[],"tags":["mac","emacs"],"title":"Macos Stage å¿«æ·é”®"},{"authors":[],"categories":[],"content":"æ˜¯ä¸€æ¬¾è„šæœ¬ç»˜å›¾è¯­è¨€ç¨‹åº, æä¾›ä¸°å¯Œçš„ç‰¹æ€§, å…¶ä¸­æˆ‘æœ€å–œæ¬¢çš„åŠŸèƒ½åŒ…æ‹¬å¯ç”Ÿæˆç®­å¤´æµåŠ¨æ•ˆæœ\nTable of Contents Introduction Usage Org mode TALA License Introduction D2 æ˜¯ä¸€æ¬¾è„šæœ¬ç»˜å›¾è¯­è¨€ç¨‹åº, æä¾›ä¸°å¯Œçš„ç‰¹æ€§ , å…¶ä¸­æˆ‘æœ€å–œæ¬¢çš„åŠŸèƒ½åŒ…æ‹¬å¯ç”Ÿæˆç®­å¤´æµåŠ¨æ•ˆæœ,ç®€æ´çš„è¯­æ³•, é¿å…ä½¿ç”¨ quote (å¼•å·) å¯¹ç©ºæ ¼çš„æ”¯æŒ, å¤šç±»å‹çš„å¸ƒå±€ç­‰ç­‰, æˆ‘ä»¬é¦–å…ˆè¯´ä¸‹ D2 çš„å¸ƒå±€, ä¸€å…±åˆ†ä¸º3ç§å¸ƒå±€\ndagre ,ä¸€ç§æœ‰å‘å›¾, åŸºäº Graphvizâ€™s DOT ç®—æ³•ä¸å¸ƒå±€, å¦‚æœä½ å¾ˆç†Ÿæ‚‰dot ä¸å¦¨è¯•è¯•è¿™ç§å¸ƒå±€ ELK ,ä¹Ÿæ˜¯ä¸€ç§æœ‰å‘å›¾, ä½†å®˜æ–¹å®£ç§°æ¯”dagreæ›´æˆç†Ÿ TALA, å…¨æ–°çš„ ä»˜è´¹ å¸ƒå±€å¼•æ“, å®˜æ–¹å®£ç§°æ˜¯ç‰¹åˆ«é’ˆå¯¹è½¯ä»¶æ¡†æ¶å›¾è€Œè®¾è®¡çš„å¸ƒå±€ ç»¼åˆæ¥è¯´, å…¶å®å®˜æ–¹ä¹Ÿæ²¡è¯´çš„å¾ˆæ˜ç™½,ä¸è¿‡ç”±äº TALA æ˜¯ä»˜è´¹çš„å¸ƒå±€,æœ‰ä¸“é—¨çš„ç½‘ç«™å’Œæ¼”ç¤ºæ¡ˆä¾‹. ç¡®å®è®©äººå¿ƒåŠ¨.å¹¸è¿çš„æ˜¯è™½è¯´ TALA æ˜¯ä»˜è´¹çš„,ä½†ä»–å´æä¾›è½¯ä»¶çš„æºä»£ç ,æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ TALA å¸ƒå±€åªä¸è¿‡åœ¨ç”Ÿæˆå‡ºæ¥çš„å›¾ç‰‡ä¸­å«æœ‰ LICENSE COPY çš„æ°´å°ï¼ˆåé¢è®²æ€ä¹ˆå»é™¤ï¼‰.\nUsage ä½ çš„ç¬¬ä¸€ä¸ªD2æ¶æ„å›¾,ä»£ç å¦‚ä¸‹.\ndirection ä»£è¡¨äº†å¸ƒå±€çš„æ–¹å‘, style.fill ä»£è¡¨äº†èƒŒæ™¯å›¾ä¸ dot å’Œ plantuml ä¸€æ ·,éƒ½å¯ä»¥æ”¯æŒé€æ˜èƒŒæ™¯ transparent. d2æ”¯æŒæˆ‘ä»¬å®šä¹‰ä¸€äº›é¢„ç½®çš„ class æ ·å¼,è§classesä»£ç ç‰‡æ®µ. è¿æ¥çº¿çš„æ ·å¼ä¸­æœ‰æˆ‘ä»¬å–œé—»ä¹è§çš„ style.animated è¿™å°±æ˜¯è¿æ¥çº¿åŠ¨æ€æ•ˆæœçš„è®¾ç½®. åœ¨æœ€æ–°çš„ v0.6.0 ä¸­,å¯ä»¥é€šè¿‡åœ¨varså¯¹è±¡ä¸­çš„é”®å€¼å¯¹æ¥ç”³æ˜å˜é‡,è¿™æå¤§æ–¹ä¾¿äº†æˆ‘ä»¬åœ¨ç”»å›¾æ—¶å¯¹é¢œè‰²å’Œå±æ€§çš„é‡å¤å¼•ç”¨. åœ¨æœ€æ–°çš„ v0.6.0 ä¸­,å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥æŒ‡å®šèŠ‚ç‚¹çš„æ ·å¼ *.style.fillï¼ˆç›®å‰ä»…é’ˆæ”¯æŒèŠ‚ç‚¹,ä¸æ”¯æŒè¿æ¥çº¿ï¼‰. æ¥ä¸‹æ¥æˆ‘å£°æ˜äº†Aã€Bã€C 3ä¸ªèŠ‚ç‚¹,å¹¶ä¸”åˆ†åˆ«å¼•ç”¨ 2dn(2d node) å’Œ 3dn(3d node).\ndirection : right style.fill : transparent vars: { nodecolor : \u0026quot;#E67E22\u0026quot; style-stroke : \u0026quot;#17202A\u0026quot; style-stroke-width : 2 style-fill-pattern : dots style-shadow : true line-style-fill : \u0026quot;#884EA0\u0026quot; } classes: { 2dn: { style.multiple : true } 3dn: { style.3d : true } 2de: { style.animated : true style.stroke-width : ${style-stroke-width} style.stroke : ${line-style-fill} } } A : { class : 2dn } B : { class : 3dn } C : { class : 3dn } A -\u0026gt; B -\u0026gt; C -\u0026gt; D{ class : 2de } *.style.fill : ${nodecolor} *.style.stroke : ${style-stroke} *.style.stroke-width : ${style-stroke-width} *.style.fill-pattern : ${style-fill-pattern} *.style.shadow : ${style-shadow} Org mode æœ€ååˆ†äº«å¦‚ä½•åœ¨ org mode ä¸­ä½¿ç”¨d2.\nåœ¨ org mode ä¸­å¼•å…¥æ–°çš„ src block æ‰§è¡Œä»£ç å—,ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ä½œä¸ºå‚è€ƒ.æˆ‘åœ¨è¿™é‡Œå¢åŠ äº†d2çš„æ‰‹ç»˜é£æ ¼çš„ä»£ç ,å…¶åŸå› æ˜¯d2çš„éƒ¨åˆ†è®¾ç½®éœ€è¦åœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡Œè®¾ç½®.ç±»ä¼¼äºå›¾ç‰‡é—´å®½ã€å¸ƒå±€å¼•æ“ã€åŠ¨ç”»é€Ÿç‡ç­‰å‚æ•°å‡æ˜¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥è®¾ç½®çš„,æ— æ³•åœ¨src blockå†…è¿›è¡Œè®¾å®š.å› æ­¤æˆ‘åœ¨fishå†…å¢åŠ äº†è½¯è¿æ¥å¸¦å…¥é»˜è®¤å‚æ•°,ä»¥æ­¤æ¥å®ç°åœ¨org modeä¸­è¿›è¡Œä¸åŒé£æ ¼çš„d2è®¾ç½®åˆ‡æ¢.\nalias ds2 \u0026quot;~/soft/d2-v0.6.0/bin/d2 --sketch --animate-interval=1400 -l elk -c --pad 0\u0026quot; ;;; ds2.el --- Babel Functions for ds2 -*- lexical-binding: t; -*- ;; Copyright (C) 2009-2022 Free Software Foundation, Inc. ;; Author: Eric Schulte ;; Maintainer: Justin Abrahms \u0026lt;justin@abrah.ms\u0026gt; ;; Keywords: literate programming, reproducible research ;; URL: https://orgmode.org ;; This file is part of GNU Emacs. ;; GNU Emacs is free software: you can redistribute it and/or modify ;; it under the terms of the GNU General Public License as published by ;; the Free Software Foundation, either version 3 of the License, or ;; (at your option) any later version. ;; GNU Emacs is distributed in the hope that it will be useful, ;; but WITHOUT ANY WARRANTY; without even the implied warranty of ;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the ;; GNU General Public License for more details. ;; You should have received a copy of the GNU General Public License ;; along with GNU Emacs. If not, see \u0026lt;https://www.gnu.org/licenses/\u0026gt;. ;;; Commentary: (require 'org-macs) (org-assert-version) (defvar org-babel-default-header-args:ds2 '((:results . \u0026quot;file\u0026quot;) (:exports . \u0026quot;results\u0026quot;)) \u0026quot;Default arguments to use when evaluating a ds2 source block.\u0026quot;) (defun org-babel-expand-body:ds2 (body params) \u0026quot;Expand BODY according to PARAMS, return the expanded body.\u0026quot; (let ((vars (org-babel--get-vars params))) (mapc (lambda (pair) (let ((name (symbol-name (car pair))) (value (cdr pair))) (setq body (replace-regexp-in-string (concat \u0026quot;$\u0026quot; (regexp-quote name)) (if (stringp value) value (format \u0026quot;%S\u0026quot; value)) body t t)))) vars) body)) (defun org-babel-execute:ds2 (body params) \u0026quot; This function is called by `org-babel-execute-src-block'.\u0026quot; (let* ((out-file (cdr (or (assq :file params) (error \u0026quot;You need to specify a :file parameter\u0026quot;)))) (cmdline (or (cdr (assq :cmdline params)))) (cmd (or (cdr (assq :cmd params)) (concat \u0026quot;ds2 \u0026quot; \u0026quot;\u0026quot;))) (coding-system-for-read 'utf-8) ;use utf-8 with sub-processes (coding-system-for-write 'utf-8) (in-file (org-babel-temp-file \u0026quot;ds2-\u0026quot;))) (with-temp-file in-file (insert (org-babel-expand-body:ds2 body params))) (org-babel-eval (concat cmd \u0026quot; \u0026quot; (org-babel-process-file-name in-file) \u0026quot; \u0026quot; cmdline \u0026quot; \u0026quot; (org-babel-process-file-name out-file)) \u0026quot;\u0026quot;) nil)) ;; signal that output has already been written to file (defun org-babel-prep-session:ds2 (_session _params) \u0026quot;Return an error because ds2 does not support sessions.\u0026quot; (error \u0026quot;ds2 does not support sessions\u0026quot;)) (provide 'ds2) TALA License ç»å¸¸æ€§çš„åœ¨ org mode ä¸­å¯¼å‡º html ,é‡åˆ°æœ€å¤šçš„é—®é¢˜æ˜¯,å½“æˆ‘ä»¬æŠŠ html å‘é€ç»™å…¶ä»–äººæ—¶,é‡Œé¢çš„å›¾ç‰‡å°±ä¸èƒ½æ‰“å¼€äº†.è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å‘é€å‡ºå»çš„ä»…æ˜¯ html ä»£ç , åªåŒ…æ‹¬äº†å›¾ç‰‡åœ°å€,ä¸åŒ…æ‹¬å›¾ç‰‡çš„å†…å®¹. ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,æˆ‘ä»¬å¯ä»¥åœ¨ç”Ÿæˆ html çš„åŒæ—¶å°†å›¾ç‰‡ä»¥base64çš„å½¢å¼ç›´æ¥åµŒå…¥è‡³htmlæ–‡ä»¶å†….\nd2 çš„ TALA å¸ƒå±€æ˜¯ä¸€ä¸ªæ”¶è´¹çš„å¸ƒå±€å¼•æ“,ä½†å¹¸è¿çš„æ˜¯å°½ç®¡ä»–æ”¶è´¹,ä½†æ˜¯å´å¼€æº.æˆ‘ä»¬ä»ç„¶å¯ä»¥ä¸‹è½½TALAå¼•æ“çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶,åªä¸è¿‡åœ¨æœªæˆæƒçš„æ—¶å€™ä¼šåœ¨å›¾ç‰‡ä¸­ç”Ÿæˆ UNLICENSED COPY çš„æ°´å°.svgçš„æ°´å°å¾ˆå¥½å»é™¤,ç”¨text-modeæ‰“å¼€æ–‡ä»¶,æ‰¾åˆ°æ°´å°å­—æ ·åˆ é™¤å³å¯.åˆ©ç”¨ä¸Šé¢çš„åœ¨å°†å›¾ç‰‡è½¬æ¢æˆBASE64çš„æ—¶å€™æˆ‘ä»¬ä»…éœ€è¦å°† UNLICENSED COPY æ›¿æ¢æˆç©ºå°±å®Œæˆäº†æ°´å°å»é™¤äº†.\n;; html image base64 (defun org-html--format-image-old (source attributes info) (org-html-close-tag \u0026quot;img\u0026quot; (org-html--make-attribute-string (org-combine-plists (list :src source :alt (if (string-match-p (concat \u0026quot;^\u0026quot; org-preview-latex-image-directory) source) (org-html-encode-plain-text (org-find-text-property-in-string 'org-latex-src source)) (file-name-nondirectory source))) (if (string= \u0026quot;svg\u0026quot; (file-name-extension source)) (org-combine-plists '(:class \u0026quot;org-svg\u0026quot;) attributes '(:fallback nil)) attributes))) info)) (defun org-org-html--format-image (source attributes info) ;; doc (if (string-match \u0026quot;http\u0026quot; source) (org-html--format-image-old source attributes info) (format \u0026quot;\u0026lt;img src=\\\u0026quot;data:image/%s+xml;base64,%s\\\u0026quot;%s width=%s /\u0026gt;\u0026quot; (or (file-name-extension source) \u0026quot;\u0026quot;) (base64-encode-string (with-temp-buffer (insert-file-contents-literally source) (string-replace \u0026quot;UNLICENSED COPY\u0026quot; \u0026quot; \u0026quot; (buffer-string)))) (file-name-nondirectory source) \u0026quot;100%\u0026quot;))) (advice-add #'org-html--format-image :override #'org-org-html--format-image) ","permalink":"/posts/%E4%BD%BF%E7%94%A8d2%E7%BB%98%E5%9B%BE/","series":[],"tags":["org","emacs"],"title":"ä½¿ç”¨d2ç»˜å›¾"},{"authors":[],"categories":[],"content":"Mybatis Config é›ªèŠ±ç®—æ³•idï¼Œç”¨ redis è‡ªåŠ¨ç®¡ç† workerIdã€‚\næœ¬ç« ä»£ç ç›´æ¥æä¾›äº†ä½¿ç”¨ mybatis é…ç½®é›ªèŠ±ç®—æ³• idï¼Œå¹¶ä¸”åˆ©ç”¨ redis è‡ªåŠ¨æ³¨å†Œ workerIdï¼›\nå¦å¤–æä¾›äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè®© springboot åœ¨å¯åŠ¨å¥½ä¹‹å‰å°±åˆå§‹åŒ–å¥½æ•°æ®åº“è¿æ¥æ± ï¼›\n@Slf4j @Configuration @EnableTransactionManagement public class MybatisPlusConfig { private final String idWorker = \u0026quot;WorkerId\u0026quot;; @Value(\u0026quot;${spring.application.name}\u0026quot;) private String serviceName; @Resource private RedisTemplate\u0026lt;String,Long\u0026gt; redisTemplate; private final String script = \u0026quot;local now = redis.call('TIME')[1]\\n\u0026quot; + \u0026quot;local idWordsKey = KEYS[1]\\n\u0026quot; + \u0026quot;local sp = ':'\\n\u0026quot; + \u0026quot;for i = 0, 1023 do\\n\u0026quot; + \u0026quot; local serviceKey = idWordsKey..sp..i\\n\u0026quot; + \u0026quot; if redis.call('SETNX', serviceKey, now) == 1 then\\n\u0026quot; + \u0026quot; redis.call('Expire', serviceKey, 30)\\n\u0026quot; + \u0026quot; return i;\\n\u0026quot; + \u0026quot; end\\n\u0026quot; + \u0026quot;end\\n\u0026quot; + \u0026quot;return -1\u0026quot;; /** * åˆ†é¡µæ’ä»¶ */ @Bean public MybatisPlusInterceptor mybatisPlusInterceptor() { MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor(); interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL)); return interceptor; } @Bean public IdentifierGenerator idGenerator() { if (serviceName == null || serviceName.length() == 0){ log.error(\u0026quot;é›ªèŠ±ç®—æ³•åˆå§‹åŒ–å¤±è´¥ï¼Œã€ app.idKey ã€‘é…ç½®ä¸ºç©ºã€‚\u0026quot;); return null; } long num = getWorkerIdNum(); // è·å–å‰ 5 ä½ long dataCenterId = num \u0026gt;\u0026gt; 5; // è· å– å 5 ä½ long workerId = num \u0026amp; (~(-1L \u0026lt;\u0026lt; 5L)); // è‡ªå®šä¹‰åˆå§‹åŒ–é›ªèŠ±ç®—æ³• log.info(\u0026quot;==== [Init Snowflake suceessfully]: dataCenterId:{},workerId:{}\u0026quot;, dataCenterId, workerId); return new DefaultIdentifierGenerator(workerId, dataCenterId); } /** * è·å–æœºå™¨æ ‡è¯†å· * param serviceName æœåŠ¡åç§°,ä¸å†éœ€è¦,r edis æ¡†æ¶è‡ªåŠ¨æ·»åŠ æœåŠ¡å */ private Long getWorkerIdNum() { // å®ä¾‹åŒ–è„šæœ¬å¯¹è±¡ DefaultRedisScript\u0026lt;Long\u0026gt; lua = new DefaultRedisScript\u0026lt;\u0026gt;(); lua.setResultType(Long.class); lua.setScriptText(script); List\u0026lt;String\u0026gt; keys = new ArrayList\u0026lt;\u0026gt;(2); keys.add(idWorker); // è·å–åºåˆ—å· Long num = redisTemplate.execute(lua, keys, keys.size()); String targetKey = String.join(\u0026quot;:\u0026quot;, keys) + \u0026quot;:\u0026quot; + num; // -1 ä»£è¡¨æœºå™¨ç”¨å®Œäº†ï¼Œé‡è¯• if (num \u0026lt; 0){ log.erro r( \u0026quot;ç›®å‰ Id å·²ç”¨å®Œï¼Œè¯·é‡æ–°å¯åŠ¨è¯•è¯•\u0026quot;); System.exit(0); } // è‡ªåŠ¨ç»­æœŸ this.autoExpire(targetKey); return num; } /** * è‡ªåŠ¨ç»­æœŸ */ private void autoExpire(String key) { ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1, new BasicThreadFactory.Builder().namingPattern(\u0026quot;id_auto_expire-%d\u0026quot;).daemon(true).build()); executorService.scheduleAtFixedRate(() -\u0026gt; { redisTemplate.expire(key, 30, TimeUnit.SECONDS); log.debu g( \u0026quot;è‡ªåŠ¨ç»­æœŸ id æˆåŠŸ:{}\u0026quot;, key); }, 0, 10, TimeUnit.SECONDS); } public String getServiceName() { return serviceName; } public void setServiceName(String serviceName) { this.serviceName = serviceName; } /** * init connection when springboot startup */ @Bean public ApplicationRunner connectionInit(DataSource dataSource) { return args -\u0026gt; { dataSource.getConnection(); log.info(\u0026quot;==== [datasource connection inited]\u0026quot;); }; } ","permalink":"/posts/mybatis-config/","series":[],"tags":["java"],"title":"Mybatis Config é›ªèŠ±ç®—æ³•idï¼Œç”¨ redis ç®¡ç† workerId"},{"authors":[],"categories":[],"content":"springcloud æ•´åˆ shardingsphere åŠ seata, ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯æä¾›äº†ååˆ†ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆ\nå‚ç›´ vs æ°´å¹³ æ‹†åˆ† å‚ç›´åˆ†åº“ï¼ŒæŠŠå•ä¸€æ•°æ®åº“æŒ‰ä¸šåŠ¡è¿›è¡Œåˆ’åˆ†ï¼Œåšåˆ°ä¸“åº“ä¸“è¡¨\nå‚ç›´åˆ†è¡¨ï¼ŒæŠŠè¡¨ä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®åˆ—å­˜å‚¨åˆ°ä¸€å¼ è¡¨ï¼Œå†å°†å¦å¤–ä¸€éƒ¨åˆ†æ•°æ®åˆ—å­˜å‚¨åˆ°å¦å¤–ä¸€å¼ æˆ–å¤šå¼ è¡¨ï¼Œè¿™ç§æ–¹å¼å«å‚ç›´åˆ†è¡¨\nå‚ç›´åˆ†ï¼Œéƒ½æ˜¯åˆ‡åˆ†è¡¨å¤´ï¼Œæ›´å¤šè€ƒè™‘å¾®æœåŠ¡åˆ’åˆ†å’Œæ•°æ®åº“è®¾è®¡ã€‚\næ°´å¹³åˆ†åº“ï¼Œè¡¨çš„æ•°æ®ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨ä¸€ä¸ªæ•°æ®åº“ï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®å­˜å‚¨åœ¨å¦å¤–ä¸€ä¸ªæ•°æ®åº“ä¸­\næ°´å¹³åˆ†è¡¨ï¼Œè¡¨çš„æ•°æ®ä¸€éƒ¨åˆ†å­˜å‚¨åœ¨ä¸€ä¸ªè¡¨ï¼Œå¦ä¸€éƒ¨åˆ†æ•°æ®å­˜å‚¨åœ¨å¦å¤–ä¸€ä¸ªè¡¨ä¸­\næ°´å¹³åˆ†ï¼Œéƒ½æ˜¯åˆ‡è¡¨ä½“\nåˆ†åº“åˆ†è¡¨å¸¦æ¥çš„é—®é¢˜ï¼š\nè·¨èŠ‚ç‚¹è¿æ¥æŸ¥è¯¢é—®é¢˜ï¼Œåˆ†é¡µã€æ’åº å¤šæ•°æ®æºç®¡ç†é—®é¢˜ï¼Œ springcloud æ•´åˆ shardingsphere åŠ seata ä¾èµ– ä¾èµ–æˆ‘ä»¬é€‰æ‹©å¼•å…¥ã€spring-cloud-starter-alibaba-seata ä½œä¸º seata çš„èµ·æ­¥ä¾èµ–ã€sharding-jdbc-spring-boot-starter ä½œä¸º shardingshpere åˆ†åº“åˆ†è¡¨çš„æ ¸å¿ƒä¾èµ–ã€sharding-transaction-base-seata-at ä½œä¸º shardingsphere æ”¯æŒ seata-at æ¨¡å¼çš„ä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-seata\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${depend on you springcloud version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.shardingsphere\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;sharding-jdbc-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.1.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.shardingsphere\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;sharding-transaction-base-seata-at\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.1.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ•°æ®åº“ç¯å¢ƒ æ¨¡æ‹Ÿåˆ†åº“ï¼ˆæœ€å¸¸è§çš„æ–¹æ¡ˆï¼‰ï¼Œæ¨¡æ‹Ÿå°†æ•°æ®åˆ†åº“å­˜å‚¨è‡³ 2 ä¸ªä¸åŒçš„åº“ï¼Œé¦–å…ˆåˆ›å»ºå¥½ 2 ä¸ªæ•°æ®åº“ cube_ld_archetype_dev_1ã€cube_ld_archetype_dev_1ï¼Œå¹¶ä¸”åˆ›å»ºç›¸åŒçš„è¡¨ t_ld_daily_user_dã€‚\ndelimiter ; CREATE TABLE cube_ld_archetype_dev_1.t_ld_daily_user_d ( `id` bigint NOT NULL, `name` varchar(16) NOT NULL COMMENT 'å§“å', `dd_union_id` varchar(32) DEFAULT NULL COMMENT 'é’‰é’‰ id', `gender` tinyint NOT NULL COMMENT 'æ€§åˆ«ï¼Œ1 ç”· 2 å¥³', `mobile` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL, `phone` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL, `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', `modifier` bigint NOT NULL DEFAULT '-1' COMMENT 'ä¿®æ”¹äºº', `creator` bigint NOT NULL DEFAULT '-1' COMMENT 'åˆ›å»ºäºº', `tenant_id` bigint NOT NULL DEFAULT '-1' COMMENT 'ç§Ÿæˆ·', PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='ç”¨æˆ·è¡¨'; CREATE TABLE cube_ld_archetype_dev_2.t_ld_daily_user_d ( `id` bigint NOT NULL, `name` varchar(16) NOT NULL COMMENT 'å§“å', `dd_union_id` varchar(32) DEFAULT NULL COMMENT 'é’‰ é’‰ id', `gender` tinyint NOT NULL COMMENT 'æ€§åˆ«ï¼Œ1 ç”· 2 å¥³', `mobile` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL, `phone` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL, `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´', `modifier` bigint NOT NULL DEFAULT '-1' COMMENT 'ä¿®æ”¹äºº', `creator` bigint NOT NULL DEFAULT '-1' COMMENT 'åˆ›å»ºäºº', `tenant_id` bigint NOT NULL DEFAULT '-1' COMMENT 'ç§Ÿæˆ·', PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT='ç”¨æˆ·è¡¨'; ç”±äºä½¿ç”¨äº† seata çš„ at æ¨¡å¼ï¼Œå› æ­¤éœ€è¦åœ¨æ¯ä¸ªåº“åˆ›å»º undo_log è¡¨\ndelimiter ; CREATE TABLE IF NOT EXISTS cube_ld_archetype_dev_1.`undo_log` ( `branch_id` BIGINT NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(128) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8mb4 COMMENT ='AT transaction mode undo table'; ALTER TABLE cube_ld_archetype_dev_1.`undo_log` ADD INDEX `ix_log_created` (`log_created`); CREATE TABLE IF NOT EXISTS cube_ld_archetype_dev_2.`undo_log` ( `branch_id` BIGINT NOT NULL COMMENT 'branch transaction id', `xid` VARCHAR(128) NOT NULL COMMENT 'global transaction id', `context` VARCHAR(128) NOT NULL COMMENT 'undo_log context,such as serialization', `rollback_info` LONGBLOB NOT NULL COMMENT 'rollback info', `log_status` INT(11) NOT NULL COMMENT '0:normal status,1:defense status', `log_created` DATETIME(6) NOT NULL COMMENT 'create datetime', `log_modified` DATETIME(6) NOT NULL COMMENT 'modify datetime', UNIQUE KEY `ux_undo_log` (`xid`, `branch_id`) ) ENGINE = InnoDB AUTO_INCREMENT = 1 DEFAULT CHARSET = utf8mb4 COMMENT ='AT transaction mode undo table'; ALTER TABLE cube_ld_archetype_dev_2.`undo_log` ADD INDEX `ix_log_created` (`log_created`); ç¼–å†™é…ç½® ç”±äºä½¿ç”¨äº† springcloud-seata å’Œ springcloud-shardingsphere çš„ä¾èµ–ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åœ¨æ³¨å†Œä¸­å¿ƒä¸Šè¿›è¡Œé…ç½®;\nå¯ä»¥ä½¿ç”¨ 2 ä¸ªé…ç½®æ–‡ä»¶æ¥è¿›è¡Œ seata å’Œ shardingsphere åˆ†å¼€é…ç½®ï¼›\nsharingsphere é…ç½®ä½¿ç”¨ tenant_id æ¥è¿›è¡Œåˆ†åº“ï¼›\nseata é…ç½®, æ­¤é…ç½®å¯åœ¨ nacos é…ç½®ä¸­å¿ƒå®Œæˆ\nseata: config: type: nacos nacos: server-addr: ${spring.cloud.nacos.config.server-addr} group: SEATA_GROUP namespace: ${spring.cloud.nacos.config.namespace} username: ${nacos.username} password: ${nacos.password} cluster: default data-id: seataServer.properties registry: type: nacos nacos: server-addr: ${spring.cloud.nacos.discovery.server-addr} group: SEATA_GROUP namespace: ${spring.cloud.nacos.discovery.namespace} username: ${nacos.username} password: ${nacos.password} application: seata-server cluster: default tx-service-group: default_tx_group service: vgroup-mapping: default_tx_group: default enable-auto-data-source-proxy: true data-source-proxy-mode: AT shardingsphere é…ç½®ï¼Œæ­¤é…ç½®å¯åœ¨ nacos é…ç½®ä¸­å¿ƒå®Œæˆ\nspring: jackson: time-zone: Asia/Shanghai cache: type: none shardingsphere: dataSource: names: ds1,ds2 ds1: type: com.zaxxer.hikari.HikariDataSource driverClassName: com.mysql.cj.jdbc.Driver jdbc-url: jdbc:mysql://dsip1:3306/cube_ld_archetype_dev_1?useUnicode=true\u0026amp;characterEncoding=UTF-8\u0026amp; serverTimezone=Asia/Shanghai\u0026amp;zeroDateTimeBehavior=convertToNull\u0026amp; autoReconnect=true\u0026amp;failOverReadOnly=false\u0026amp;maxReconnects=2\u0026amp;useSSL=false username: root password: xxx ds2: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver jdbc-url: jdbc:mysql://dsip2:3306/cube_ld_archetype_dev_2?useUnicode=true\u0026amp;characterEncoding=UTF-8\u0026amp; serverTimezone=Asia/Shanghai\u0026amp;zeroDateTimeBehavior=convertToNull\u0026amp; autoReconnect=true\u0026amp;failOverReadOnly=false\u0026amp;maxReconnects=2\u0026amp;useSSL=false username: root password: xxx sharding: tables: t_ld_daily_user_d: database-strategy: inline: sharding-column: tenant_id algorithm-expression: ds$-\u0026gt;{tenant_id % 2 + 1} seata.conf è¿™ä¸€æ­¥æ˜¯ shardingsphere ä¸ seata æ•´åˆçš„é…ç½®ï¼Œæ­¤é…ç½®éœ€è¦åœ¨é¡¹ç›®çš„ resource ç›®å½•ä¸‹ï¼Œç›®å‰ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½†æ˜¯è¦å®ç°åœ¨ nacos ä¸Šé…ç½®ä¹Ÿä¸éš¾ã€‚\nsharding.transaction.seata.at.enable=true client.application.id=archetype client.transaction.service.group=default_tx_group ç¼–å†™ä»£ç  æ³¨æ„ï¼š@Transactional å’Œ @ShardingTransactionType æ³¨è§£å¿…é¡»åŒæ—¶æ·»åŠ æ‰èƒ½ä½¿åˆ†å¸ƒå¼äº‹åŠ¡ç”Ÿæ•ˆ TransactionType.BASE å…¶å®å°±æ˜¯ shardingsphere å¯¹äºå¼±ä¸€è‡´æ€§äº‹åŠ¡çš„å®šä¹‰ï¼Œåœ¨è¿™é‡Œå¯ç†è§£ TransactionType.BASE æ˜¯ seata at äº‹åŠ¡çš„æ˜ å°„ã€‚ å½“ç„¶é™¤äº†å¼±ä¸€è‡´æ€§ä»¥å¤–ï¼Œè¿˜æœ‰å¼ºä¸€è‡´æ€§ XA äº‹åŠ¡ï¼Œseata é»˜è®¤ä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œåªæ˜¯ XA äº‹åŠ¡ä¾èµ–æ•°æ®åº“æ”¯æŒï¼Œåœ¨ä½¿ç”¨ XA äº‹åŠ¡æ—¶ä½ éœ€è¦æå‰ç¡®è®¤æ•°æ®åº“æ˜¯å¦æ”¯æŒ XA äº‹åŠ¡ã€‚\nåœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œç¨‹åºæœ‰ä¸€ä¸ªé™¤é›¶é”™è¯¯ï¼Œæ•…æ„è®¾è®¡ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬æœŸæœ›åˆ†å¸ƒå¼äº‹åŠ¡ç”Ÿæ•ˆçš„æƒ…å†µä¸‹ï¼Œèƒ½å›æ»š userMapper.insert(user1) è¿™è¡Œä»£ç å¯¹æ•°æ®åº“çš„æ“ä½œã€‚\n/** * save mutiple record * testing distributed transaction */ @PostMapping(\u0026quot;/saveTestShardingSphere\u0026quot;) @Transactional(rollbackFor = Exception.class) @ShardingTransactionType(TransactionType.BASE) public Result\u0026lt;Long\u0026gt; saveTestShardingSphere() { User user1 = new User(); user1.setId(1L); user1.setTenantId(1L); user1.setName(\u0026quot;van1\u0026quot;); user1.setGender(true); user1.setPhone(\u0026quot;7789\u0026quot;); user1.setDdUnionId(\u0026quot;7789\u0026quot;); userMapper.insert(user1); User user2 = new User(); user2.setId(2L); user2.setTenantId(2L); user2.setName(\u0026quot;van2\u0026quot;); user2.setGender(true); user2.setPhone(\u0026quot;7789\u0026quot;); user2.setDdUnionId(\u0026quot;7789\u0026quot;); userMapper.insert(user2); int errorInt = 1 / 0; return Result.success(); } å¯åŠ¨ seata-server seata çš„ AT äº‹åŠ¡è¦æ±‚ TC ä¸ RM èƒ½åŒå‘é€šè®¯ï¼Œå› æ­¤åœ¨åšæµ‹è¯•çš„æ—¶å€™ï¼Œå¸¸å¸¸éœ€è¦åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª seata-serverï¼ˆTCï¼‰ä»¥ç¡®ä¿äº‹åŠ¡ç”Ÿæ•ˆã€‚\ncd $seata-server-home/bin sh seata-server.sh -p 8091 -h 172.20.10.2 -m file tail -f ../logs/start.out å¯åŠ¨ springcloud é¡¹ç›® mvn clean -T 1C install -f ../pom.xml -Dmaven.test.skrp=true -U java \\ -Xms1024m -Xmx1024m \\ -Dspring.application.name=archetype \\ -Dspring.cloud.nacos.config.file-extension=yml \\ -Duser.timezone=GMT+08 \\ -Dserver.port=8080 \\ -Dspring.cloud.nacos.discovery.server-addr=nacos:8848 \\ -Dspring.cloud.nacos.discovery.namespace=e29572d7-7ccc-4a18-81da-dbe891677336 \\ -Dspring.cloud.nacos.config.server-addr=nacos:8848 \\ -Dspring.cloud.nacos.config.namespace=e29572d7-7ccc-4a18-81da-dbe891677336 \\ -Dspring.config.import[0]=nacos:seata-at \\ -Dspring.config.import[1]=nacos:archetype-shardingjdbcDb \\ -Dspring.cloud.nacos.discovery.register-enabled=true \\ -Dlogging.level.com.baomidou.mybatisplus=DEBUG \\ -Dmybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl \\ -jar ./target/archetype.jar æ¥å£æµ‹è¯• å‘èµ·è¯·æ±‚æµ‹è¯•\nPOST http://localhost:8080/user/saveTestShardingSphere æ•°æ®åº“æŸ¥çœ‹\ndelimiter ; -- delete from cube_ld_archetype_dev_1.t_ld_daily_user_d; -- delete from cube_ld_archetype_dev_2.t_ld_daily_user_d; SELECT * FROM cube_ld_archetype_dev_1.t_ld_daily_user_d; SELECT * FROM cube_ld_archetype_dev_2.t_ld_daily_user_d; æ—¥å¿—\nBranch Rollbacked result: PhaseTwo_Rollbacked æ€»ç»“ shardingsphere ä¸ seata çš„æ•´åˆçš„ç¡®åšåˆ°äº†é…ç½®æ¸…æ™°ï¼Œä½¿ç”¨ç®€å•ï¼›\nå¼ºå¼ºè”åˆï¼Œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯æä¾›äº†ååˆ†ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼›\n","permalink":"/posts/seata-shardingsphere1/","series":[],"tags":["java"],"title":"springcloud æ•´åˆ shardingsphere åŠ seata"},{"authors":[],"categories":[],"content":"å¦‚ä½•æ’æŸ¥ï¼šjava.lang.OutOfMemoryError: unable to create native thread\njava.lang.OutOfMemoryError: unable to create native thread æµ‹è¯•ä»£ç  for (int i = 0; i \u0026lt; 3500; i++) { new Thread(() -\u0026gt; { try { try {Thread.sleep(5000L);} catch (InterruptedException e) {e.printStackTrace();} TimeUnit.HOURS.sleep(1); log.info(\u0026quot;\\n==== [log]: {} {}\u0026quot;, \u0026quot;sleep over\u0026quot;,Thread.currentThread().getName()); } catch (InterruptedException e) { e.printStackTrace(); } }).start(); } ç›¸å…³æŒ‡ä»¤ æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹æ•°é‡\njstack -l PID | grep 'java.lang.Thread.State' | wc -l jstack -l PID | grep 'java.lang.Thread.State: RUNNABLE' | wc -l jstack -l PID | grep 'java.lang.Thread.State: TIMED_WAITING' | wc -l jstack -l PID | grep 'java.lang.Thread.State: WAITING' | wc -l jstack -l PID | grep 'java.lang.Thread.State:BLOCKED' | wc -l jstack -l PID | grep 'Java-level deadlock' | wc -l æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹çŠ¶æ€\njstack -l PID | grep 'java.lang.Thread.State' æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹ä¿¡æ¯\njstack -l PID è¿”å›ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°é˜»å¡çš„ä»£ç ä¿¡æ¯\n\u0026quot;Thread-4050\u0026quot; #4136 prio=5 os_prio=31 cpu=1.00ms elapsed=546.19s tid=0x0000000130247000 nid=0x354103 waiting on condition [0x00000004b9a2e000] java.lang.Thread.State: TIMED_WAITING (sleeping) at java.lang.Thread.sleep(java.base@11.0.13/Native Method) at java.lang.Thread.sleep(java.base@11.0.13/Thread.java:334) at java.util.concurrent.TimeUnit.sleep(java.base@11.0.13/TimeUnit.java:446) at com....controller.CommentsController$$M$_jr_0E50A6F6C7FE22B0_1 .lambda$0(CommentsController.java:129) at com....controller.CommentsController$$Lambda$964$$M$_jr_0E50A6F6C7FE22B0_1 /0x0000000800e11c40.run(Unknown Source) at java.lang.Thread.run(java.base@11.0.13/Thread.java:829) ","permalink":"/posts/java-oom/","series":[],"tags":["java"],"title":"java æ ˆæº¢å‡ºé—®é¢˜æ’æŸ¥"},{"authors":[],"categories":[],"content":"RocketMQä¸»è¦ç”± Producerã€Brokerã€Consumer ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­Producer è´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ï¼ŒConsumer è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼ŒBroker è´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚\nç®€ä»‹ é¡¹ç›®åœ°å€ï¼šhttps://github.com/apache/rocketmq/tree/master\nRocketMQä¸»è¦ç”± Producerã€Brokerã€Consumer ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­Producer è´Ÿè´£ç”Ÿäº§æ¶ˆæ¯ï¼ŒConsumer è´Ÿè´£æ¶ˆè´¹æ¶ˆæ¯ï¼ŒBroker è´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚Broker åœ¨å®é™…éƒ¨ç½²è¿‡ç¨‹ä¸­å¯¹åº”ä¸€å°æœåŠ¡å™¨ï¼Œæ¯ä¸ª Broker å¯ä»¥å­˜å‚¨å¤šä¸ªTopicçš„æ¶ˆæ¯ï¼Œæ¯ä¸ªTopicçš„æ¶ˆæ¯ä¹Ÿå¯ä»¥åˆ†ç‰‡å­˜å‚¨äºä¸åŒçš„ Brokerã€‚Message Queue ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ç‰©ç†åœ°å€ï¼Œæ¯ä¸ªTopicä¸­çš„æ¶ˆæ¯åœ°å€å­˜å‚¨äºå¤šä¸ª Message Queue ä¸­ã€‚ConsumerGroup ç”±å¤šä¸ªConsumer å®ä¾‹æ„æˆã€‚\næ¶ˆæ¯çš„å‘å¸ƒæ˜¯æŒ‡æŸä¸ªç”Ÿäº§è€…å‘æŸä¸ªtopicå‘é€æ¶ˆæ¯ï¼›æ¶ˆæ¯çš„è®¢é˜…æ˜¯æŒ‡æŸä¸ªæ¶ˆè´¹è€…å…³æ³¨äº†æŸä¸ªtopicä¸­å¸¦æœ‰æŸäº›tagçš„æ¶ˆæ¯ï¼Œè¿›è€Œä»è¯¥topicæ¶ˆè´¹æ•°æ®ã€‚\næ¶æ„ NameServeræ˜¯ä¸€ä¸ªå‡ ä¹æ— çŠ¶æ€èŠ‚ç‚¹ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— ä»»ä½•ä¿¡æ¯åŒæ­¥ã€‚\nBrokeréƒ¨ç½²ç›¸å¯¹å¤æ‚ï¼ŒBrokeråˆ†ä¸ºMasterä¸Slaveï¼Œä¸€ä¸ªMasterå¯ä»¥å¯¹åº”å¤šä¸ªSlaveï¼Œä½†æ˜¯ä¸€ä¸ªSlaveåªèƒ½å¯¹åº”ä¸€ä¸ªMasterï¼ŒMasterä¸Slave çš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„BrokerNameï¼Œä¸åŒçš„BrokerId æ¥å®šä¹‰ï¼ŒBrokerIdä¸º0è¡¨ç¤ºMasterï¼Œé0è¡¨ç¤ºSlaveã€‚Masterä¹Ÿå¯ä»¥éƒ¨ç½²å¤šä¸ªã€‚æ¯ä¸ªBrokerä¸NameServeré›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†ŒTopicä¿¡æ¯åˆ°æ‰€æœ‰NameServerã€‚ æ³¨æ„ï¼šå½“å‰RocketMQç‰ˆæœ¬åœ¨éƒ¨ç½²æ¶æ„ä¸Šæ”¯æŒä¸€Masterå¤šSlaveï¼Œä½†åªæœ‰BrokerId=1çš„ä»æœåŠ¡å™¨æ‰ä¼šå‚ä¸æ¶ˆæ¯çš„è¯»è´Ÿè½½ã€‚\nProducerä¸NameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼‰å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä»NameServerè·å–Topicè·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾›Topic æœåŠ¡çš„Masterå»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘Masterå‘é€å¿ƒè·³ã€‚Producerå®Œå…¨æ— çŠ¶æ€ï¼Œå¯é›†ç¾¤éƒ¨ç½²ã€‚\nConsumerä¸NameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼‰å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä»NameServerè·å–Topicè·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾›TopicæœåŠ¡çš„Masterã€Slaveå»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘Masterã€Slaveå‘é€å¿ƒè·³ã€‚Consumeræ—¢å¯ä»¥ä»Masterè®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä»Slaveè®¢é˜…æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…åœ¨å‘Masteræ‹‰å–æ¶ˆæ¯æ—¶ï¼ŒMasteræœåŠ¡å™¨ä¼šæ ¹æ®æ‹‰å–åç§»é‡ä¸æœ€å¤§åç§»é‡çš„è·ç¦»ï¼ˆåˆ¤æ–­æ˜¯å¦è¯»è€æ¶ˆæ¯ï¼Œäº§ç”Ÿè¯»I/Oï¼‰ï¼Œä»¥åŠä»æœåŠ¡å™¨æ˜¯å¦å¯è¯»ç­‰å› ç´ å»ºè®®ä¸‹ä¸€æ¬¡æ˜¯ä»Masterè¿˜æ˜¯Slaveæ‹‰å–ã€‚\nRocketMQæ¶æ„ä¸Šä¸»è¦åˆ†ä¸ºå››éƒ¨åˆ†ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º:\nProducerï¼šæ¶ˆæ¯å‘å¸ƒçš„è§’è‰²ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚Produceré€šè¿‡MQçš„è´Ÿè½½å‡è¡¡æ¨¡å—é€‰æ‹©ç›¸åº”çš„Brokeré›†ç¾¤é˜Ÿåˆ—è¿›è¡Œæ¶ˆæ¯æŠ•é€’ï¼ŒæŠ•é€’çš„è¿‡ç¨‹æ”¯æŒå¿«é€Ÿå¤±è´¥å¹¶ä¸”ä½å»¶è¿Ÿã€‚\nConsumerï¼šæ¶ˆæ¯æ¶ˆè´¹çš„è§’è‰²ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤æ–¹å¼éƒ¨ç½²ã€‚æ”¯æŒä»¥pushæ¨ï¼Œpullæ‹‰ä¸¤ç§æ¨¡å¼å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚åŒæ—¶ä¹Ÿæ”¯æŒé›†ç¾¤æ–¹å¼å’Œå¹¿æ’­æ–¹å¼çš„æ¶ˆè´¹ï¼Œå®ƒæä¾›å®æ—¶æ¶ˆæ¯è®¢é˜…æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°ç”¨æˆ·çš„éœ€æ±‚ã€‚\nNameServerï¼šNameServeræ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„Topicè·¯ç”±æ³¨å†Œä¸­å¿ƒï¼Œå…¶è§’è‰²ç±»ä¼¼Dubboä¸­çš„zookeeperï¼Œæ”¯æŒBrokerçš„åŠ¨æ€æ³¨å†Œä¸å‘ç°ã€‚ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªåŠŸèƒ½ï¼šBrokerç®¡ç†ï¼ŒNameServeræ¥å—Brokeré›†ç¾¤çš„æ³¨å†Œä¿¡æ¯å¹¶ä¸”ä¿å­˜ä¸‹æ¥ä½œä¸ºè·¯ç”±ä¿¡æ¯çš„åŸºæœ¬æ•°æ®ã€‚ç„¶åæä¾›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ£€æŸ¥Brokeræ˜¯å¦è¿˜å­˜æ´»ï¼›è·¯ç”±ä¿¡æ¯ç®¡ç†ï¼Œæ¯ä¸ªNameServerå°†ä¿å­˜å…³äºBrokeré›†ç¾¤çš„æ•´ä¸ªè·¯ç”±ä¿¡æ¯å’Œç”¨äºå®¢æˆ·ç«¯æŸ¥è¯¢çš„é˜Ÿåˆ—ä¿¡æ¯ã€‚ç„¶åProducerå’ŒConumseré€šè¿‡NameServerå°±å¯ä»¥çŸ¥é“æ•´ä¸ªBrokeré›†ç¾¤çš„è·¯ç”±ä¿¡æ¯ï¼Œä»è€Œè¿›è¡Œæ¶ˆæ¯çš„æŠ•é€’å’Œæ¶ˆè´¹ã€‚NameServeré€šå¸¸ä¹Ÿæ˜¯é›†ç¾¤çš„æ–¹å¼éƒ¨ç½²ï¼Œå„å®ä¾‹é—´ç›¸äº’ä¸è¿›è¡Œä¿¡æ¯é€šè®¯ã€‚Brokeræ˜¯å‘æ¯ä¸€å°NameServeræ³¨å†Œè‡ªå·±çš„è·¯ç”±ä¿¡æ¯ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªNameServerå®ä¾‹ä¸Šé¢éƒ½ä¿å­˜ä¸€ä»½å®Œæ•´çš„è·¯ç”±ä¿¡æ¯ã€‚å½“æŸä¸ªNameServerå› æŸç§åŸå› ä¸‹çº¿äº†ï¼ŒBrokerä»ç„¶å¯ä»¥å‘å…¶å®ƒNameServeråŒæ­¥å…¶è·¯ç”±ä¿¡æ¯ï¼ŒProducerå’ŒConsumerä»ç„¶å¯ä»¥åŠ¨æ€æ„ŸçŸ¥Brokerçš„è·¯ç”±çš„ä¿¡æ¯ã€‚\nBrokerServerï¼šBrokerä¸»è¦è´Ÿè´£æ¶ˆæ¯çš„å­˜å‚¨ã€æŠ•é€’å’ŒæŸ¥è¯¢ä»¥åŠæœåŠ¡é«˜å¯ç”¨ä¿è¯ï¼Œä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼ŒBrokeråŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦å­æ¨¡å—ã€‚\nRemoting Moduleï¼šæ•´ä¸ªBrokerçš„å®ä½“ï¼Œè´Ÿè´£å¤„ç†æ¥è‡ªClientç«¯çš„è¯·æ±‚ã€‚ Client Managerï¼šè´Ÿè´£ç®¡ç†å®¢æˆ·ç«¯(Producer/Consumer)å’Œç»´æŠ¤Consumerçš„Topicè®¢é˜…ä¿¡æ¯ã€‚ Store Serviceï¼šæä¾›æ–¹ä¾¿ç®€å•çš„APIæ¥å£å¤„ç†æ¶ˆæ¯å­˜å‚¨åˆ°ç‰©ç†ç¡¬ç›˜å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚ HA Serviceï¼šé«˜å¯ç”¨æœåŠ¡ï¼Œæä¾›Master Broker å’Œ Slave Brokerä¹‹é—´çš„æ•°æ®åŒæ­¥åŠŸèƒ½ã€‚ Index Serviceï¼šæ ¹æ®ç‰¹å®šçš„Message keyå¯¹æŠ•é€’åˆ°Brokerçš„æ¶ˆæ¯è¿›è¡Œç´¢å¼•æœåŠ¡ï¼Œä»¥æä¾›æ¶ˆæ¯çš„å¿«é€ŸæŸ¥è¯¢ã€‚ éƒ¨ç½² ç»“åˆéƒ¨ç½²æ¶æ„å›¾ï¼Œæè¿°é›†ç¾¤å·¥ä½œæµç¨‹ï¼š\nå¯åŠ¨NameServerï¼ŒNameServerèµ·æ¥åç›‘å¬ç«¯å£ï¼Œç­‰å¾…Brokerã€Producerã€Consumerè¿ä¸Šæ¥ï¼Œç›¸å½“äºä¸€ä¸ªè·¯ç”±æ§åˆ¶ä¸­å¿ƒã€‚ Brokerå¯åŠ¨ï¼Œè·Ÿæ‰€æœ‰çš„NameServerä¿æŒé•¿è¿æ¥ï¼Œå®šæ—¶å‘é€å¿ƒè·³åŒ…ã€‚å¿ƒè·³åŒ…ä¸­åŒ…å«å½“å‰Brokerä¿¡æ¯(IP+ç«¯å£ç­‰)ä»¥åŠå­˜å‚¨æ‰€æœ‰Topicä¿¡æ¯ã€‚æ³¨å†ŒæˆåŠŸåï¼ŒNameServeré›†ç¾¤ä¸­å°±æœ‰Topicè·ŸBrokerçš„æ˜ å°„å…³ç³»ã€‚ æ”¶å‘æ¶ˆæ¯å‰ï¼Œå…ˆåˆ›å»ºTopicï¼Œåˆ›å»ºTopicæ—¶éœ€è¦æŒ‡å®šè¯¥Topicè¦å­˜å‚¨åœ¨å“ªäº›Brokerä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨å‘é€æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºTopicã€‚ Producerå‘é€æ¶ˆæ¯ï¼Œå¯åŠ¨æ—¶å…ˆè·ŸNameServeré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€å°å»ºç«‹é•¿è¿æ¥ï¼Œå¹¶ä»NameServerä¸­è·å–å½“å‰å‘é€çš„Topicå­˜åœ¨å“ªäº›Brokerä¸Šï¼Œè½®è¯¢ä»é˜Ÿåˆ—åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç„¶åä¸é˜Ÿåˆ—æ‰€åœ¨çš„Brokerå»ºç«‹é•¿è¿æ¥ä»è€Œå‘Brokerå‘æ¶ˆæ¯ã€‚ Consumerè·ŸProducerç±»ä¼¼ï¼Œè·Ÿå…¶ä¸­ä¸€å°NameServerå»ºç«‹é•¿è¿æ¥ï¼Œè·å–å½“å‰è®¢é˜…Topicå­˜åœ¨å“ªäº›Brokerä¸Šï¼Œç„¶åç›´æ¥è·ŸBrokerå»ºç«‹è¿æ¥é€šé“ï¼Œå¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ã€‚ å•èŠ‚ç‚¹éƒ¨ç½² è®¾ç½®ç¯å¢ƒå˜é‡ 1 set -x ROCKETMQ_HOME /Users/van/soft/rocketMQ ä¸‹è½½é¡¹ç›®è‡³ROCKETMQ_HOMEæ–‡ä»¶ç›®å½•ï¼Œ\nhttps://github.com/apache/rocketmq/tree/master\nä¸‹è½½é¡¹ç›®è‡³ROCKETMQ_HOMEæ–‡ä»¶ç›®å½•ï¼Œ\nhttps://github.com/apache/rocketmq-dashboard\nå¯åŠ¨NameServer 1 nohup sh $ROCKETMQ_HOME/rocketmq-4.9.3/bin/mqnamesrv \u0026amp; 2 tail -f ~/logs/rocketmqlogs/namesrv.log 3 jps å¯åŠ¨borkerServer 1 nohup sh $ROCKETMQ_HOME/rocketmq-4.9.3/bin/mqbroker -n localhost:9876 \u0026amp; 2 tail -f ~/logs/rocketmqlogs/broker.log 3 jps å¯åŠ¨ç®¡ç†ç«¯ é¡¹ç›®åœ°å€ï¼šhttps://github.com/apache/rocketmq-dashboard\nä¿®æ”¹nameserveråœ°å€ï¼Œapplication.yml\n1 ... 2 namesrvAddrs: 3 - 127.0.0.1:9876 4 ... å¯åŠ¨å‘½ä»¤\nmvn springboot:run è®¿é—®åœ°å€ï¼šhttp://localhost:8080/#/topic\næ¶ˆæ¯å‘é€å’Œæ¶ˆè´¹æµ‹è¯• 1 #bash 2 export NAMESRV_ADDR=localhost:9876 3 #fish 4 set -x NAMESRV_ADDR localhost:9876 5 sh $ROCKETMQ_HOME/rocketmq-4.9.3/bin/tools.sh org.apache.rocketmq.example.quickstart.Producer 6 sh $ROCKETMQ_HOME/rocketmq-4.9.3/bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer å¤åˆ¶å’Œåˆ·ç›˜ç­–ç•¥ å¤åˆ¶ç­–ç•¥ï¼šåŒæ­¥å¤åˆ¶ã€å¼‚æ­¥å¤åˆ¶ï¼Œbroker masterä¸ slaver ä¹‹é—´æ•°æ®åŒæ­¥ç­–ç•¥\nåˆ·ç›˜ç­–ç•¥ï¼šåŒæ­¥åˆ·ç›˜ã€å¼‚æ­¥åˆ·ç›˜ï¼Œå¼‚æ­¥åˆ·ç›˜ä¸€èˆ¬æ˜¯å°†æ•°æ®å­˜å‚¨è‡³pageCache,è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶è‡ªåŠ¨è¿›è¡Œè½ç›˜\nblocker é›†ç¾¤æ¨¡å¼ å•Master åªæœ‰ä¸€ä¸ªblockerï¼Œåªèƒ½åœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼Œæœ‰å•ç‚¹æ•…éšœ\nå¤šMaster brokerä»…ç”±å¤šä¸ªmasteræ„æˆï¼Œä¸å­˜åœ¨slaverã€‚åŒä¸€ä¸ªtopicçš„å„ä¸ªqueueä¼šå¹³å‡åˆ†å¸ƒè‡³å¤šä¸ªmasterèŠ‚ç‚¹ã€‚\nä¼˜ç‚¹ï¼šé…ç½®ç®€å•ã€å•ä¸ªmasterå®•æœºå¯¹é›†ç¾¤æ²¡å½±å“ã€‚å‰ææ˜¯éœ€è¦é…ç½®ç£ç›˜é˜µåˆ—ã€‚raidç£ç›˜é˜µåˆ—çš„æ•ˆç‡è¦é«˜äºmaster-slaveré›†ç¾¤ï¼Œraidæ˜¯ç¡¬ä»¶æ”¯æŒï¼Œæˆæœ¬è¾ƒé«˜ã€‚\nç¼ºç‚¹ï¼šæœªæ¢å¤ä¹‹å‰ï¼Œè¯¥æœºå™¨ä¸Šçš„æ¶ˆæ¯ä¸èƒ½è¢«æ¶ˆè´¹ï¼Œæ¶ˆæ¯æ—¶æ—¶æ€§ä¼šå—åˆ°å½±å“ã€‚\nå¤šMasterå¤šSlaver-å¼‚æ­¥å¤åˆ¶ masterä¸slaverä¹‹é—´æ˜¯ä¸»å¤‡å…³ç³»ï¼Œå³masterè´Ÿè´£æ¶ˆæ¯çš„è¯»å†™è¯·æ±‚ï¼Œè€Œslaverä»…è´Ÿè´£æ¶ˆæ¯çš„å¤‡ä»½ï¼Œmaterå®•æœºåçš„è§’è‰²è‡ªåŠ¨åˆ‡æ¢ã€‚\nç”±äºæ˜¯å¼‚æ­¥è´Ÿè´£ï¼Œåœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ¶‰åŠå°‘é‡æ¶ˆæ¯ä¸¢å¤±ã€‚å–å†³äºmasterå‘slaveråŒæ­¥æ•°æ®çš„æ—¶æœºã€‚\nå¤šMasterå¤šSlaver-åŒæ­¥åŒå†™ æ¶ˆæ¯å†™å…¥masteråï¼Œç­‰å¾…masterå°†ä¿¡æ¯åŒæ­¥è‡³slaveræˆåŠŸåï¼Œè¿”å›æˆåŠŸã€‚\nä¼˜ç‚¹ï¼šä¸å­˜åœ¨ä¸¢å¤±\nç¼ºç‚¹ï¼šå•ä¸ªæ¶ˆæ¯çš„RTé«˜ï¼Œå¯¼è‡´æ€§èƒ½è¦ç•¥ä½ï¼ˆçº¦10%ï¼‰ï¼Œmasterå®•æœºåä¸ä¼šè‡ªåŠ¨åˆ‡æ¢è‡³slaverã€‚\nRocketMqå·¥ä½œåŸç† æ¶ˆæ¯çš„ç”Ÿäº§è¿‡ç¨‹ Producerå‘é€æ¶ˆæ¯ä¹‹å‰ï¼Œä¼šå…ˆå‘nameserverè¯·æ±‚æ¶ˆæ¯topicçš„è·¯ç”±ä¿¡æ¯ nameserverè¿”å›è¯¥topicçš„è·¯ç”±è¡¨å’Œbrokeråˆ—è¡¨\nè·¯ç”±è¡¨ï¼šmapï¼Œkeyä¸ºtopicåç§°ã€valueæ˜¯ä¸€ä¸ªqueueDataå®ä¾‹åˆ—è¡¨ï¼Œå³åªè¦æ¶‰åŠåˆ°è¯¥topicçš„brokerï¼Œä¸€ä¸ªbrokerå¯¹åº”ä¸€ä¸ªqueue,Queuedataä¸­åŒ…å«brokerNameã€‚ç®€å•æ¥è¯´ï¼Œè·¯ç”±è¡¨çš„valueä¸ºæ‰€æœ‰æ¶‰åŠè¯¥topicçš„brokerName\nrouterMap\u0026lt;topicName,List\u0026gt;,queueData: brokerName\nBorkeråˆ—è¡¨ï¼šMap\u0026lt;brokerNameã€brokerDataMap\u0026gt;, brokerDataMap\u0026lt;brokerId,brokerIp\u0026gt; Produceræ ¹æ®æ¶ˆæ¯çš„é€‰æ‹©ç­–ç•¥ï¼Œä»queueåˆ—è¡¨ä¸­é€‰å‡ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨äºåç»­å­˜å‚¨æ¶ˆæ¯ Producerå¯¹æ¶ˆæ¯åšä¸€äº›ç‰¹æ®Šå‡ºç†ï¼Œä¾‹å¦‚æ¶ˆæ¯è¶…è¿‡4Mï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå‹ç¼© producerå‘é€‰æ‹©å‡ºçš„queueæ‰€åœ¨çš„brokerå‘å‡ºrpcè¯·æ±‚ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°é€‰æ‹©å‡ºçš„queue queueé€‰æ‹©ç®—æ³• è½®è¯¢ç®—æ³•ï¼Œæ¯ä¸ªqueueå¯å‡åŒ€æ”¶åˆ°æ¶ˆæ¯ï¼Œç”±äºéœ€è¦ç­‰åˆ°æŠ•é€’æˆåŠŸåæ‰èƒ½è¿›è¡Œä¸‹ä¸ªèŠ‚ç‚¹çš„è½®è¯¢ï¼Œå› æ­¤è¯¥ç®—æ³•å­˜åœ¨åœ¨ç”Ÿäº§è€…ç«¯æ¶ˆæ¯ç§¯å‹é—®é¢˜ï¼Œå½±å“æ¶ˆæ¯çš„æŠ•é€’æ€§èƒ½ã€‚ æœ€å°æŠ•é€’å»¶è¿Ÿç®—æ³•ï¼Œå°†æ¶ˆæ¯æŠ•é€’è‡³å»¶è¿Ÿæœ€å°çš„queue,å¯æœ‰æ•ˆæå‡æ¶ˆæ¯çš„æŠ•é€’æ€§èƒ½ã€‚é—®é¢˜æ˜¯å¯èƒ½å‡ºç°å•æœºè¿‡çƒ­ï¼Œæ¶ˆæ¯åˆ†é…ä¸å‡ã€‚ æ¶ˆæ¯å­˜å‚¨ æ•°æ®å­˜å‚¨åœ¨home/storeç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•åœ¨å¯åŠ¨æ—¶åˆ›å»ºï¼Œæ­£å¸¸å…³é—­brokerè¯¥æ¶ˆæ¯ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œå¦‚æœå¯åŠ¨å‰å‘ç°æ­¤æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™è¯´æ˜ä¹‹å‰æ˜¯éæ­£å¸¸å…³é—­ã€‚ å…¶ä¸­å­˜å‚¨ç€commitlogæ–‡ä»¶ï¼Œè€Œæ¶ˆæ¯æ˜¯å†™åœ¨commitlogæ–‡ä»¶ä¸­çš„ configç›®å½•ï¼Œå­˜æ”¾ç€brokerè¿è¡ŒæœŸé—´çš„ä¸€äº›é…ç½®æ•°æ® consumequeue, å­˜å‚¨ç€æ¶ˆè´¹é˜Ÿåˆ— indexå­˜å‚¨ç€æ¶ˆæ¯ç´¢å¼•æ–‡ä»¶ lock:è¿è¡ŒæœŸé—´ä½¿ç”¨åˆ°çš„å…¨å±€èµ„æºé” commitlogæ–‡ä»¶ åç§»é‡ ç´¢å¼•æ–‡ä»¶ Reblance æ²¡æ¬¡æ–°å¢æˆ–è€…åˆ é™¤æ¶ˆè´¹è€…çš„æ—¶å€™éƒ½ä¼šè§¦å‘reblanceï¼Œreblanceä¼šå¯¼è‡´æ¶ˆæ¯ç§¯å‹å’Œæ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ã€‚\nå¦å¤–å¦‚æœæ¶ˆè´¹è€…æ•°é‡å¤§äºqueueæ—¶ï¼Œæ¶ˆæ¯åªä¼šè´Ÿè½½è‡³æœ‰é™çš„æ¶ˆè´¹è€…ï¼Œè¿™ä¸ªå«reblanceçš„é™åˆ¶\n","permalink":"/posts/rocketmqintroduction/","series":[],"tags":["java"],"title":"RocketMQ å¿…é¡»çŸ¥é“çš„ç†è®ºçŸ¥è¯†"},{"authors":[],"categories":[],"content":"ä½¿ç”¨ Emacs å¯¼å‡º html æ ·å¼ï¼Œç±»ä¼¼äº doom emacs doc çš„ css style\næ ·å¼å¼•ç”¨ï¼šhttps://docs.doomemacs.org/latest/#/modules\nä¸€ä¸ªç±» doom doc çš„ org html æ ·å¼æ¨¡ç‰ˆ ç‚¹æ­¤é¢„è§ˆğŸª„\nä½¿ç”¨ é…ç½® snippet æ¨¡ç‰ˆï¼Œç„¶ååœ¨ org mode æ–‡ä»¶ä¸­ä½¿ç”¨ tt tab å°±å¯å±•å¼€æ­¤æ¨¡ç‰ˆã€‚\n# -*- mode: snippet -*- # name: title # key: tt # -- #+title: `(file-name-sans-extension (buffer-name))` #+SUBTITLE: this is subtitle #+AUTHOR: autor #+HTML_HEAD: \u0026lt;script src=\u0026quot;scroll.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; #+HTML_HEAD: \u0026lt;link rel=\u0026quot;stylesheet\u0026quot; type=\u0026quot;text/css\u0026quot; href=\u0026quot;org_css.css\u0026quot;/\u0026gt; #+HTML_HEAD: \u0026lt;script src=\u0026quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; #+OPTIONS: prop:nil timestamp:t \\n:t ^:nil f:t toc:t author:t num:t H:2 #+LATEX_COMPILER: xelatex #+LATEX_CLASS: elegantpaper #+MACRO: htmlred @@html:\u0026lt;font color=\u0026quot;red\u0026quot;\u0026gt;\u0026lt;/font\u0026gt;@@ #+MACRO: latexred @@latex:{\\color{red}@@@@latex:}@@ #+latex:\\newpage æƒ³ä½¿ç”¨åœ¨çº¿ç‰ˆçš„é™æ€æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é…ç½®è¿›è¡Œæ›¿æ¢\n#+HTML_HEAD: \u0026lt;link href=\u0026quot;https://emacs-1308440781.cos.ap-chengdu.myqcloud.com/org_css.css\u0026quot; rel=\u0026quot;stylesheet\u0026quot;\u0026gt;\u0026lt;/link\u0026gt; #+HTML_HEAD: \u0026lt;script src=\u0026quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; #+HTML_HEAD: \u0026lt;script src=\u0026quot;https://emacs-1308440781.cos.ap-chengdu.myqcloud.com/scroll.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; å­—ä½“æ ·å¼ Table 1: å­—ä½“æ ·å¼è¯´æ˜ ç²—ä½“ bold æ–œä½“ italic ä¸‹åˆ’çº¿ underlined ä¸­æ¨ªçº¿ strike-through ä»£ç ï¼ŒæŒ‰é”® code ç‰¹æ®Šè¯´æ˜ quote æ‘˜è¦ã€å¼•ç”¨ å¯ä½¿ç”¨`quote`æ¥è¿›è¡Œä»£ç å—è¡¥å…¨ï¼Œè¡¨ç¤ºæ‘˜è¦ï¼Œå¼•ç”¨\nTECO - Tape [later text] Editor/COrrector\nA combination text editor/really horrible ProgrammingLanguage. To quote the paper â€œRealProgrammers donâ€™t use Pascalâ€ (1983):\nnotice æ³¨æ„äº‹é¡¹ã€æé†’ ä½ æœ‰è®¸å¤šå·²æ ‡è®°çš„é¡¹ç›®å¹¶ä¸”ä½ å¯èƒ½é”™è¿‡ä¸€ä¸ªé‡è¦çš„é¡¹ç›®æ—¶ï¼Œæé†’å¯ä»¥æä¾›å¸®åŠ©\nPlease do not file or answer Doom Emacs issues on Reddit, Twitter, or StackOverflow. Kindly refer them to this section.\nè¿™æ˜¯ 1 ä¸ªä¾‹å­\næ®µè½åŠé«˜äº® Example of an comment.\nåŸæ–‡ï¼šç”¨å‹ bip äº§å“åŠŸèƒ½è¯´æ˜ ï¼Œåœ¨è¯´æ˜æ–‡æ¡£\nå¤§æ•°æ®ä¸­ æœ€å®è´µ ã€æœ€éš¾ä»¥ä»£æ›¿çš„å°±æ˜¯æ•°æ®ï¼Œä¸€åˆ‡éƒ½å›´ç»•æ•°æ®ã€‚\nHDFS æ˜¯æœ€æ—©çš„å¤§æ•°æ®å­˜å‚¨ç³»ç»Ÿï¼Œå­˜å‚¨ç€å®è´µçš„æ•°æ®èµ„äº§ï¼Œå„ç§æ–°ç®—æ³•ã€æ¡†æ¶è¦æƒ³å¾—åˆ°å¹¿æ³›ä½¿ç”¨ï¼Œå¿…é¡»æ”¯æŒ HDFSï¼Œæ‰èƒ½è·å–å·²å­˜å‚¨åœ¨é‡Œé¢çš„æ•°æ®ã€‚æ‰€ä»¥å¤§æ•°æ®æŠ€æœ¯è¶Šå‘å±•ï¼Œæ–°æŠ€æœ¯è¶Šå¤šï¼ŒHDFS å¾—åˆ°çš„æ”¯æŒè¶Šå¤šï¼Œè¶Šç¦»ä¸å¼€ HDFSã€‚HDFS ä¹Ÿè®¸ä¸æ˜¯æœ€å¥½çš„å¤§æ•°æ®å­˜å‚¨æŠ€æœ¯ï¼Œä½†ä¾ç„¶æ˜¯æœ€é‡è¦çš„å¤§æ•°æ®å­˜å‚¨æŠ€æœ¯ã€‚\nHDFS æ˜¯å¦‚ä½•å®ç°å¤§æ•°æ®é«˜é€Ÿã€å¯é çš„å­˜å‚¨å’Œè®¿é—®çš„å‘¢ï¼Ÿ\nHadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ HDFS çš„è®¾è®¡ç›®æ ‡æ˜¯ç®¡ç†æ•°ä»¥åƒè®¡çš„æœåŠ¡å™¨ã€æ•°ä»¥ä¸‡è®¡çš„ç£ç›˜ï¼Œå°†å¤§è§„æ¨¡çš„æœåŠ¡å™¨è®¡ç®—èµ„æºå½“ä½œä¸€ä¸ªå•ä¸€å­˜å‚¨ç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œå¯¹åº”ç”¨ç¨‹åºæä¾›æ•°ä»¥ PB è®¡çš„å­˜å‚¨å®¹é‡ï¼Œè®©åº”ç”¨ç¨‹åºåƒä½¿ç”¨æ™®é€šæ–‡ä»¶ç³»ç»Ÿä¸€æ ·å­˜å‚¨å¤§è§„æ¨¡çš„æ–‡ä»¶æ•°æ®ã€‚ è¡¨æ ¼ C-c ~ to convert to tabel.el table\nC-c ~ to convert to org table\norg table M-h M-l for move Columns left and right\norg table M-k M-j for move Rows up and down\n# table.el for merge Columns or Rows Table 2: square N N^2 N^3 N^4 sqrt(n) sqrt[4](N) 1 1 1 1 1 1 2 4 8 16 1.4142136 1.1892071 3 9 27 81 1.7320508 1.3160740 Table 3: student Student Prob 1 Prob 2 Prob 3 Total Note Maximum 10 15 25 50 10.0 Peter 10 8 23 41 8.2 Sam 2 4 3 9 1.8 Average \u0026#xa0; \u0026#xa0; \u0026#xa0; 25.0 \u0026#xa0; Table 4: long table Format Fine-grained-control Initial Effort Syntax simplicity Editor Support Integrations Ease-of-referencing Versatility Word Word^2 Word^3 Word^4 sqrt(Word) sqrt(sqrt(Word)) 2 2 LaTeX LaTeX^2 LaTeX^3 LaTeX^4 sqrt(LaTeX) sqrt(sqrt(LaTeX)) 4 3 Org Mode Org^2 Mode^2 Org^3 Mode^3 Org^4 Mode^4 sqrt(Org Mode) sqrt(sqrt(Org Mode)) 4 4 Markdown Markdown^2 Markdown^3 Markdown^4 sqrt(Markdown) sqrt(sqrt(Markdown)) 3 1 Markdown + Pandoc (Markdown + Pandoc)^2 (Markdown + Pandoc)^3 (Markdown + Pandoc)^4 sqrt(Markdown + Pandoc) sqrt(sqrt(Markdown + Pandoc)) 3 2 awk è¡¨æ ¼ aardvark 555-5553 1200/300 B alpo-net 555-3412 2400/1200/300 A barfly 555-7685 1200/300 A bites 555-1675 2400/1200/300 A camelot 555-0542 300 C core 555-2912 1200/300 C fooey 555-1234 2400/1200/300 B foot 555-6699 1200/300 B macfoo 555-6480 1200/300 A sdace 555-3430 2400/1200/300 A sabafoo 555-2127 1200/300 C /foo/ { print $0 } Table 5: ç­›é€‰å‡º foo åŒ¹é…çš„è¡Œ fooey 555-1234 2400/1200/300 B foot 555-6699 1200/300 B macfoo 555-6480 1200/300 A sabafoo 555-2127 1200/300 C è¡¨æ ¼è‡ªå¢ id 0 å­—æ®µå åç§° 1 age å¹´é¾„ 2 bir å‡ºç”Ÿå¹´æœˆæ—¥ #+tblfm: $1=@#-1 C-c C-c to execute it\nLaTex å…¬å¼ $\\mbox{éœ€æ±‚çš„ä»·æ ¼å¼¹æ€§ç³»æ•°} = \\frac{\\mbox{éœ€æ±‚çš„å˜åŠ¨ç‡}}{\\mbox{ä»·æ ¼çš„å˜åŠ¨ç‡}}$ $$\\mbox{éœ€æ±‚çš„ä»·æ ¼å¼¹æ€§ç³»æ•°} = \\frac{\\mbox{éœ€æ±‚çš„å˜åŠ¨ç‡}}{\\mbox{ä»·æ ¼çš„å˜åŠ¨ç‡}}$$\n$$\\begin{aligned} \\cos 3\\theta \u0026amp; = \\cos (2 \\theta + \\theta) \\ \u0026amp; = \\cos 2 \\theta \\cos \\theta - \\sin 2 \\theta \\sin \\theta \\ \u0026amp; = (2 \\cos ^2 \\theta -1) \\cos \\theta - (2 \\sin \\theta\\cos \\theta ) \\sin \\theta \\ \u0026amp; = 2 \\cos ^3 \\theta - \\cos \\theta - 2 \\sin ^2 \\theta \\cos \\theta \\ \u0026amp; = 2 \\cos ^3 \\theta - \\cos \\theta - 2 (1 - \\cos ^2 \\theta )\\cos \\theta \\ \u0026amp; = 4 \\cos ^3 \\theta -3 \\cos \\theta \\end{aligned} $$\nOrg ä»£ç  ä»£ç ç‰‡æ®µå¼€å¯è¡Œå·ï¼Œä¿®æ”¹ `~/.emacs.d/.local/straight/repos/org/lisp/ox-html.el`\n(let* ((code-lines (split-string code \u0026quot;\\n\u0026quot;)) (code-length (length code-lines)) (num-fmt (and num-start (format \u0026quot;%%%ds \u0026quot; (format \u0026quot;%%%ds: \u0026quot; Java ä»£ç  /** * @param request è°ƒç”¨çš„è¯·æ±‚å‚æ•° * @param needLog true éœ€è¦è®°å½•æ—¥å¿— false ä¸è®°å½•æ—¥å¿— * @return */ protected NcApiResponse runApply(NcApiRequest request, Boolean needLog) { NcApiResponse ncApiResponse = null; try { final NcApiRequest ncApiRequest = executeBefore(request); ncApiResponse = executeGetRequest(ncApiRequest); } catch (Exception e) { afterExecute(needLog, e, request, ncApiResponse); if (e instanceof BizException) { throw new BizException(\u0026quot;NC æç¤º\u0026quot;, ((BizException) e).getErrorMsg(), e); } else { throw new BizException(\u0026quot;NC å¼‚å¸¸\u0026quot;, e.getMessage()); } } return ncApiResponse; } babel java List\u0026lt;Integer\u0026gt; a = Arrays.asList(1, 2); List\u0026lt;Integer\u0026gt; a = Arrays.asList(1, 2); List\u0026lt;Integer\u0026gt; a = Arrays.asList(1, 2); List\u0026lt;Integer\u0026gt; a = Arrays.asList(1, 2); List\u0026lt;Integer\u0026gt; a = Arrays.asList(1, 2); return a; C-c C-c to execute it, but export to html will fail when the babel java result generated.\nå›¾ç‰‡ å¼•ç”¨æœ¬åœ°å›¾ç‰‡ å¼•ç”¨ç½‘ç»œå›¾ç‰‡ dot graphviz dot\ndot sk\nplantuml plantuml with style css\nplantuml æ›¿æ¢åŸç”Ÿæ ·å¼\nDARKO RANGE/LIGHTORANGE/DARKBLUE/LIGHTBLUE/DARKRED/LIGHTRED/DARKGREEN/LIGHTGREEN\n!define LIGHTORANGE !includeurl C4-PlantUML/juststyle.puml plant uml ç³»ç»Ÿ Contex æ¶æ„å›¾\nplantuml æ›¿æ¢åŸç”Ÿæ ·å¼\nDARKORANGE/LIGHTORANGE/DARKBLUE/LIGHTBLUE/DARKRED/LIGHTRED/DARKGREEN/LIGHTGREEN\n!define LIGHTBLUE !includeurl C4-PlantUML/juststyle.puml æ³³é“å›¾\nplantuml htmlstyle\norg è½¬ Word pandoc -o ~/Desktop/out.docx ~/.doom.d/README.org æ’å…¥æ—¶é—´ C-c . æ’å…¥å½“å‰æ—¶é—´ \u0026lt;2023-02-25 Sat\u0026gt; K lask week J next week L next day ","permalink":"/posts/orgmodecss/","series":[],"tags":["org","emacs"],"title":"æ¨èä¸€æ¬¾ org mode å¯¼å‡º html çš„æ ·å¼"}]